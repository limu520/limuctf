(function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch",NAME:"node_name"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove",SELECTED:"ztree_selected",UNSELECTED:"ztree_unselected"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nodeClasses:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true,txtSelectedEnable:false},data:{key:{isParent:"isParent",children:"children",name:"name",title:"",url:"url",icon:"icon"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",headers:{},xhrFields:{},url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);if(!r){r={};data.setRoot(setting,r)}data.nodeChildren(setting,r,[]);r.expandTriggerFlag=false;r.curSelectedList=[];r.noSelection=true;r.createdNodes=[];r.zId=0;r._ver=(new Date()).getTime()},_initCache=function(setting){var c=data.getCache(setting);if(!c){c={};data.setCache(setting,c)}c.nodes=[];c.doms=[]},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node])});o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag])});o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node])});o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node])});o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg])});o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown])});o.bind(c.REMOVE,function(event,treeId,treeNode){tools.apply(setting.callback.onRemove,[event,treeId,treeNode])});o.bind(c.SELECTED,function(event,treeId,node){tools.apply(setting.callback.onSelected,[treeId,node])});o.bind(c.UNSELECTED,function(event,treeId,node){tools.apply(setting.callback.onUnSelected,[treeId,node])})},_unbindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED).unbind(c.CLICK).unbind(c.EXPAND).unbind(c.COLLAPSE).unbind(c.ASYNC_SUCCESS).unbind(c.ASYNC_ERROR).unbind(c.REMOVE).unbind(c.SELECTED).unbind(c.UNSELECTED)},_eventProxy=function(event){var target=event.target,setting=data.getSetting(event.data.treeId),tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")){treeEventType="mousedown"}else{if(tools.eqs(event.type,"mouseup")){treeEventType="mouseup"}else{if(tools.eqs(event.type,"contextmenu")){treeEventType="contextmenu"}else{if(tools.eqs(event.type,"click")){if(tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.SWITCH)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="switchNode"}else{tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="clickNode"}}}else{if(tools.eqs(event.type,"dblclick")){treeEventType="dblclick";tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="switchNode"}}}}}}if(treeEventType.length>0&&tId.length==0){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"switchNode":var isParent=data.nodeIsParent(setting,node);if(!isParent){nodeEventType=""}else{if(tools.eqs(event.type,"click")||(tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))){nodeEventCallback=handler.onSwitchNode}else{nodeEventType=""}}break;case"clickNode":nodeEventCallback=handler.onClickNode;break}}switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu;break}var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return}var r=data.getRoot(setting),children=data.nodeChildren(setting,n);n.level=level;n.tId=setting.treeId+"_"+(++r.zId);n.parentTId=parentNode?parentNode.tId:null;n.open=(typeof n.open=="string")?tools.eqs(n.open,"true"):!!n.open;var isParent=data.nodeIsParent(setting,n);if(tools.isArray(children)){data.nodeIsParent(setting,n,true);n.zAsync=true}else{isParent=data.nodeIsParent(setting,n,isParent);n.open=(isParent&&!setting.async.enable)?n.open:false;n.zAsync=!isParent}n.isFirstNode=isFirstNode;n.isLastNode=isLastNode;n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId)};n.getPreNode=function(){return data.getPreNode(setting,n)};n.getNextNode=function(){return data.getNextNode(setting,n)};n.getIndex=function(){return data.getNodeIndex(setting,n)};n.getPath=function(){return data.getNodePath(setting,n)};n.isAjaxing=false;data.fixPIdKeyValue(setting,n)},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=node},getNodeCacheId:function(tId){return tId.substring(tId.lastIndexOf("_")+1)},addAfterA:function(afterA){_init.afterA.push(afterA)},addBeforeA:function(beforeA){_init.beforeA.push(beforeA)},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA)},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA)},addInitBind:function(bindEvent){_init.bind.push(bindEvent)},addInitUnBind:function(unbindEvent){_init.unbind.push(unbindEvent)},addInitCache:function(initCache){_init.caches.push(initCache)},addInitNode:function(initNode){_init.nodes.push(initNode)},addInitProxy:function(initProxy,isFirst){if(!!isFirst){_init.proxys.splice(0,0,initProxy)}else{_init.proxys.push(initProxy)}},addInitRoot:function(initRoot){_init.roots.push(initRoot)},addNodesData:function(setting,parentNode,index,nodes){var children=data.nodeChildren(setting,parentNode),params;if(!children){children=data.nodeChildren(setting,parentNode,[]);index=-1}else{if(index>=children.length){index=-1}}if(children.length>0&&index===0){children[0].isFirstNode=false;view.setNodeLineIcos(setting,children[0])}else{if(children.length>0&&index<0){children[children.length-1].isLastNode=false;view.setNodeLineIcos(setting,children[children.length-1])}}data.nodeIsParent(setting,parentNode,true);if(index<0){data.nodeChildren(setting,parentNode,children.concat(nodes))}else{params=[index,0].concat(nodes);children.splice.apply(children,params)}},addSelectedNode:function(setting,node){var root=data.getRoot(setting);if(!data.isSelectedNode(setting,node)){root.curSelectedList.push(node)}},addCreatedNode:function(setting,node){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);root.createdNodes.push(node)}},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools)},exSetting:function(s){$.extend(true,_setting,s)},fixPIdKeyValue:function(setting,node){if(setting.data.simpleData.enable){node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId}},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++){_init.afterA[i].apply(this,arguments)}},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++){_init.beforeA[i].apply(this,arguments)}},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++){_init.innerAfterA[i].apply(this,arguments)}},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++){_init.innerBeforeA[i].apply(this,arguments)}},getCache:function(setting){return caches[setting.treeId]},getNodeIndex:function(setting,node){if(!node){return null}var p=node.parentTId?node.getParentNode():data.getRoot(setting),children=data.nodeChildren(setting,p);for(var i=0,l=children.length-1;i<=l;i++){if(children[i]===node){return i}}return -1},getNextNode:function(setting,node){if(!node){return null}var p=node.parentTId?node.getParentNode():data.getRoot(setting),children=data.nodeChildren(setting,p);for(var i=0,l=children.length-1;i<=l;i++){if(children[i]===node){return(i==l?null:children[i+1])}}return null},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key){return null}for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(node[key]==value){return nodes[i]}var children=data.nodeChildren(setting,node);var tmp=data.getNodeByParam(setting,children,key,value);if(tmp){return tmp}}return null},getNodeCache:function(setting,tId){if(!tId){return null}var n=caches[setting.treeId].nodes[data.getNodeCacheId(tId)];return n?n:null},getNodePath:function(setting,node){if(!node){return null}var path;if(node.parentTId){path=node.getParentNode().getPath()}else{path=[]}if(path){path.push(node)}return path},getNodes:function(setting){return data.nodeChildren(setting,data.getRoot(setting))},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key){return[]}var result=[];for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(node[key]==value){result.push(node)}var children=data.nodeChildren(setting,node);result=result.concat(data.getNodesByParam(setting,children,key,value))}return result},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key){return[]}var result=[];value=value.toLowerCase();for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(typeof node[key]=="string"&&nodes[i][key].toLowerCase().indexOf(value)>-1){result.push(node)}var children=data.nodeChildren(setting,node);result=result.concat(data.getNodesByParamFuzzy(setting,children,key,value))}return result},getNodesByFilter:function(setting,nodes,filter,isSingle,invokeParam){if(!nodes){return(isSingle?null:[])}var result=isSingle?null:[];for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(tools.apply(filter,[node,invokeParam],false)){if(isSingle){return node}result.push(node)}var children=data.nodeChildren(setting,node);var tmpResult=data.getNodesByFilter(setting,children,filter,isSingle,invokeParam);if(isSingle&&!!tmpResult){return tmpResult}result=isSingle?tmpResult:result.concat(tmpResult)}return result},getPreNode:function(setting,node){if(!node){return null}var p=node.parentTId?node.getParentNode():data.getRoot(setting),children=data.nodeChildren(setting,p);for(var i=0,l=children.length;i<l;i++){if(children[i]===node){return(i==0?null:children[i-1])}}return null},getRoot:function(setting){return setting?roots[setting.treeId]:null},getRoots:function(){return roots},getSetting:function(treeId){return settings[treeId]},getSettings:function(){return settings},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++){_init.caches[i].apply(this,arguments)}},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++){_init.nodes[i].apply(this,arguments)}},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++){_init.roots[i].apply(this,arguments)}},isSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]){return true}}return false},nodeChildren:function(setting,node,newChildren){if(!node){return null}var key=setting.data.key.children;if(typeof newChildren!=="undefined"){node[key]=newChildren}return node[key]},nodeIsParent:function(setting,node,newIsParent){if(!node){return false}var key=setting.data.key.isParent;if(typeof newIsParent!=="undefined"){if(typeof newIsParent==="string"){newIsParent=tools.eqs(newIsParent,"true")}newIsParent=!!newIsParent;node[key]=newIsParent}else{if(typeof node[key]=="string"){node[key]=tools.eqs(node[key],"true")}else{node[key]=!!node[key]}}return node[key]},nodeName:function(setting,node,newName){var key=setting.data.key.name;if(typeof newName!=="undefined"){node[key]=newName}return""+node[key]},nodeTitle:function(setting,node){var t=setting.data.key.title===""?setting.data.key.name:setting.data.key.title;return""+node[t]},removeNodeCache:function(setting,node){var children=data.nodeChildren(setting,node);if(children){for(var i=0,l=children.length;i<l;i++){data.removeNodeCache(setting,children[i])}}data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=null},removeSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]||!data.getNodeCache(setting,root.curSelectedList[i].tId)){root.curSelectedList.splice(i,1);setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,node]);i--;j--}}},setCache:function(setting,cache){caches[setting.treeId]=cache},setRoot:function(setting,root){roots[setting.treeId]=root},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++){_init.zTreeTools[i].apply(this,arguments)}},transformToArrayFormat:function(setting,nodes){if(!nodes){return[]}var r=[];if(tools.isArray(nodes)){for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];_do(node)}}else{_do(nodes)}return r;function _do(_node){r.push(_node);var children=data.nodeChildren(setting,_node);if(children){r=r.concat(data.transformToArrayFormat(setting,children))}}},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey;if(!key||key==""||!sNodes){return[]}if(tools.isArray(sNodes)){var r=[];var tmpMap={};for(i=0,l=sNodes.length;i<l;i++){tmpMap[sNodes[i][key]]=sNodes[i]}for(i=0,l=sNodes.length;i<l;i++){var p=tmpMap[sNodes[i][parentKey]];if(p&&sNodes[i][key]!=sNodes[i][parentKey]){var children=data.nodeChildren(setting,p);if(!children){children=data.nodeChildren(setting,p,[])}children.push(sNodes[i])}else{r.push(sNodes[i])}}return r}else{return[sNodes]}}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++){_init.bind[i].apply(this,arguments)}},unbindEvent:function(setting){for(var i=0,j=_init.unbind.length;i<j;i++){_init.unbind[i].apply(this,arguments)}},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;if(!setting.view.txtSelectedEnable){o.bind("selectstart",handler.onSelectStart).css({"-moz-user-select":"-moz-none"})}o.bind("click",eventParam,event.proxy);o.bind("dblclick",eventParam,event.proxy);o.bind("mouseover",eventParam,event.proxy);o.bind("mouseout",eventParam,event.proxy);o.bind("mousedown",eventParam,event.proxy);o.bind("mouseup",eventParam,event.proxy);o.bind("contextmenu",eventParam,event.proxy)},unbindTree:function(setting){var o=setting.treeObj;o.unbind("selectstart",handler.onSelectStart).unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){var results=[];for(var i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);results.push(proxyResult);if(proxyResult.stop){break}}return results},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e)){return true}var results=event.doProxy(e),r=true,x=false;for(var i=0,l=results.length;i<l;i++){var proxyResult=results[i];if(proxyResult.nodeEventCallback){x=true;r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}if(proxyResult.treeEventCallback){x=true;r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}}return r}},handler={onSwitchNode:function(event,node){var setting=data.getSetting(event.data.treeId);if(node.open){if(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}else{if(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}return true},onClickNode:function(event,node){var setting=data.getSetting(event.data.treeId),clickFlag=((setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey))&&data.isSelectedNode(setting,node))?0:(setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey)&&setting.view.selectedMulti)?2:1;if(tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],true)==false){return true}if(clickFlag===0){view.cancelPreSelectedNode(setting,node)}else{view.selectNode(setting,node,clickFlag===2)}setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]);return true},onZTreeMousedown:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node])}return true},onZTreeMouseup:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node])}return true},onZTreeDblclick:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],true)){tools.apply(setting.callback.onDblClick,[event,setting.treeId,node])}return true},onZTreeContextmenu:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],true)){tools.apply(setting.callback.onRightClick,[event,setting.treeId,node])}return(typeof setting.callback.onRightClick)!="function"},onSelectStart:function(e){var n=e.originalEvent.srcElement.nodeName.toLowerCase();return(n==="input"||n==="textarea")}},tools={apply:function(fun,param,defaultValue){if((typeof fun)=="function"){return fun.apply(zt,param?param:[])}return defaultValue},canAsync:function(setting,node){var children=data.nodeChildren(setting,node);var isParent=data.nodeIsParent(setting,node);return(setting.async.enable&&node&&isParent&&!(node.zAsync||(children&&children.length>0)))},clone:function(obj){if(obj===null){return null}var o=tools.isArray(obj)?[]:{};for(var i in obj){o[i]=(obj[i] instanceof Date)?new Date(obj[i].getTime()):(typeof obj[i]==="object"?tools.clone(obj[i]):obj[i])}return o},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase()},isArray:function(arr){return Object.prototype.toString.apply(arr)==="[object Array]"},isElement:function(o){return(typeof HTMLElement==="object"?o instanceof HTMLElement:o&&typeof o==="object"&&o!==null&&o.nodeType===1&&typeof o.nodeName==="string")},$:function(node,exp,setting){if(!!exp&&typeof exp!="string"){setting=exp;exp=""}if(typeof node=="string"){return $(node,setting?setting.treeObj.get(0).ownerDocument:null)}else{return $("#"+node.tId+exp,setting?setting.treeObj:null)}},getMDom:function(setting,curDom,targetExpr){if(!curDom){return null}while(curDom&&curDom.id!==setting.treeId){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++){if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&curDom.getAttribute(targetExpr[i].attrName)!==null){return curDom}}curDom=curDom.parentNode}return null},getNodeMainDom:function(target){return($(target).parent("li").get(0)||$(target).parentsUntil("li").parent().get(0))},isChildOrSelf:function(dom,parentId){return($(dom).closest("#"+parentId).length>0)},uCanDo:function(setting,e){return true}},view={addNodes:function(setting,parentNode,index,newNodes,isSilent){var isParent=data.nodeIsParent(setting,parentNode);if(setting.data.keep.leaf&&parentNode&&!isParent){return}if(!tools.isArray(newNodes)){newNodes=[newNodes]}if(setting.data.simpleData.enable){newNodes=data.transformTozTreeFormat(setting,newNodes)}if(parentNode){var target_switchObj=$$(parentNode,consts.id.SWITCH,setting),target_icoObj=$$(parentNode,consts.id.ICON,setting),target_ulObj=$$(parentNode,consts.id.UL,setting);if(!parentNode.open){view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE);view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE);parentNode.open=false;target_ulObj.css({display:"none"})}data.addNodesData(setting,parentNode,index,newNodes);view.createNodes(setting,parentNode.level+1,newNodes,parentNode,index);if(!isSilent){view.expandCollapseParentNode(setting,parentNode,true)}}else{data.addNodesData(setting,data.getRoot(setting),index,newNodes);view.createNodes(setting,0,newNodes,null,index)}},appendNodes:function(setting,level,nodes,parentNode,index,initFlag,openFlag){if(!nodes){return[]}var html=[];var tmpPNode=(parentNode)?parentNode:data.getRoot(setting),tmpPChild=data.nodeChildren(setting,tmpPNode),isFirstNode,isLastNode;if(!tmpPChild||index>=tmpPChild.length-nodes.length){index=-1}for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(initFlag){isFirstNode=((index===0||tmpPChild.length==nodes.length)&&(i==0));isLastNode=(index<0&&i==(nodes.length-1));data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag);data.addNodeCache(setting,node)}var isParent=data.nodeIsParent(setting,node);var childHtml=[];var children=data.nodeChildren(setting,node);if(children&&children.length>0){childHtml=view.appendNodes(setting,level+1,children,node,-1,initFlag,openFlag&&node.open)}if(openFlag){view.makeDOMNodeMainBefore(html,setting,node);view.makeDOMNodeLine(html,setting,node);data.getBeforeA(setting,node,html);view.makeDOMNodeNameBefore(html,setting,node);data.getInnerBeforeA(setting,node,html);view.makeDOMNodeIcon(html,setting,node);data.getInnerAfterA(setting,node,html);view.makeDOMNodeNameAfter(html,setting,node);data.getAfterA(setting,node,html);if(isParent&&node.open){view.makeUlHtml(setting,node,html,childHtml.join(""))}view.makeDOMNodeMainAfter(html,setting,node);data.addCreatedNode(setting,node)}}return html},appendParentULDom:function(setting,node){var html=[],nObj=$$(node,setting);if(!nObj.get(0)&&!!node.parentTId){view.appendParentULDom(setting,node.getParentNode());nObj=$$(node,setting)}var ulObj=$$(node,consts.id.UL,setting);if(ulObj.get(0)){ulObj.remove()}var children=data.nodeChildren(setting,node),childHtml=view.appendNodes(setting,node.level+1,children,node,-1,false,true);view.makeUlHtml(setting,node,html,childHtml.join(""));nObj.append(html.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l;var isParent=data.nodeIsParent(setting,node);if(node&&!isParent){tools.apply(callback);return false}else{if(node&&node.isAjaxing){return false}else{if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}}}if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};var autoParam=tools.apply(setting.async.autoParam,[setting.treeId,node],setting.async.autoParam);for(i=0,l=autoParam.length;node&&i<l;i++){var pKey=autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}tmpParam[spKey]=node[pKey]}var otherParam=tools.apply(setting.async.otherParam,[setting.treeId,node],setting.async.otherParam);if(tools.isArray(otherParam)){for(i=0,l=otherParam.length;i<l;i+=2){tmpParam[otherParam[i]]=otherParam[i+1]}}else{for(var p in otherParam){tmpParam[p]=otherParam[p]}}var _tmpV=data.getRoot(setting)._ver;$.ajax({contentType:setting.async.contentType,cache:false,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:setting.async.contentType.indexOf("application/json")>-1?JSON.stringify(tmpParam):tmpParam,dataType:setting.async.dataType,headers:setting.async.headers,xhrFields:setting.async.xhrFields,success:function(msg){if(_tmpV!=data.getRoot(setting)._ver){return}var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else{if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}}catch(err){newNodes=msg}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,-1,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,-1,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(XMLHttpRequest,textStatus,errorThrown){if(_tmpV!=data.getRoot(setting)._ver){return}if(node){node.isAjaxing=null}view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown])}});return true},cancelPreSelectedNode:function(setting,node,excludeNode){var list=data.getRoot(setting).curSelectedList,i,n;for(i=list.length-1;i>=0;i--){n=list[i];if(node===n||(!node&&(!excludeNode||excludeNode!==n))){$$(n,consts.id.A,setting).removeClass(consts.node.CURSELECTED);if(node){data.removeSelectedNode(setting,node);break}else{list.splice(i,1);setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,n])}}}},createNodeCallback:function(setting){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);while(root.createdNodes.length>0){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]);if(!!setting.callback.onNodeCreated){setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node])}}}},createNodes:function(setting,level,nodes,parentNode,index){if(!nodes||nodes.length==0){return}var root=data.getRoot(setting),openFlag=!parentNode||parentNode.open||!!$$(data.nodeChildren(setting,parentNode)[0],setting).get(0);root.createdNodes=[];var zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,index,true,openFlag),parentObj,nextObj;if(!parentNode){parentObj=setting.treeObj}else{var ulObj=$$(parentNode,consts.id.UL,setting);if(ulObj.get(0)){parentObj=ulObj}}if(parentObj){if(index>=0){nextObj=parentObj.children()[index]}if(index>=0&&nextObj){$(nextObj).before(zTreeHtml.join(""))}else{parentObj.append(zTreeHtml.join(""))}}view.createNodeCallback(setting)},destroy:function(setting){if(!setting){return}data.initCache(setting);data.initRoot(setting);event.unbindTree(setting);event.unbindEvent(setting);setting.treeObj.empty();delete settings[setting.treeId]},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting);var tmpCb,_callback;if(!node){tools.apply(callback,[]);return}var children=data.nodeChildren(setting,node);var isParent=data.nodeIsParent(setting,node);if(root.expandTriggerFlag){_callback=callback;tmpCb=function(){if(_callback){_callback()}if(node.open){setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node])}else{setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node])}};callback=tmpCb;root.expandTriggerFlag=false}if(!node.open&&isParent&&((!$$(node,consts.id.UL,setting).get(0))||(children&&children.length>0&&!$$(children[0],setting).get(0)))){view.appendParentULDom(setting,node);view.createNodeCallback(setting)}if(node.open==expandFlag){tools.apply(callback,[]);return}var ulObj=$$(node,consts.id.UL,setting),switchObj=$$(node,consts.id.SWITCH,setting),icoObj=$$(node,consts.id.ICON,setting);if(isParent){node.open=!node.open;if(node.iconOpen&&node.iconClose){icoObj.attr("style",view.makeNodeIcoStyle(setting,node))}if(node.open){view.replaceSwitchClass(node,switchObj,consts.folder.OPEN);view.replaceIcoClass(node,icoObj,consts.folder.OPEN);if(animateFlag==false||setting.view.expandSpeed==""){ulObj.show();tools.apply(callback,[])}else{if(children&&children.length>0){ulObj.slideDown(setting.view.expandSpeed,callback)}else{ulObj.show();tools.apply(callback,[])}}}else{view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE);view.replaceIcoClass(node,icoObj,consts.folder.CLOSE);if(animateFlag==false||setting.view.expandSpeed==""||!(children&&children.length>0)){ulObj.hide();tools.apply(callback,[])}else{ulObj.slideUp(setting.view.expandSpeed,callback)}}}else{tools.apply(callback,[])}},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){if(!node){return}if(!node.parentTId){view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);return}else{view.expandCollapseNode(setting,node,expandFlag,animateFlag)}if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback)}},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),treeNodes=(node)?data.nodeChildren(setting,node):data.nodeChildren(setting,root),selfAnimateSign=(node)?false:animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;data.getRoot(setting).expandTriggerFlag=false;if(treeNodes){for(var i=0,l=treeNodes.length;i<l;i++){if(treeNodes[i]){view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign)}}}data.getRoot(setting).expandTriggerFlag=expandTriggerFlag;view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback)},isSelectedNode:function(setting,node){if(!node){return false}var list=data.getRoot(setting).curSelectedList,i;for(i=list.length-1;i>=0;i--){if(node===list[i]){return true}}return false},makeDOMNodeIcon:function(html,setting,node){var nameStr=data.nodeName(setting,node),name=setting.view.nameIsHTML?nameStr:nameStr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"' class='",consts.className.NAME,"'>",name,"</span>")},makeDOMNodeLine:function(html,setting,node){html.push("<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(html,setting,node){html.push("</li>")},makeDOMNodeMainBefore:function(html,setting,node){html.push("<li id='",node.tId,"' class='",consts.className.LEVEL,node.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(html,setting,node){html.push("</a>")},makeDOMNodeNameBefore:function(html,setting,node){var title=data.nodeTitle(setting,node),url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),nodeClasses=view.makeNodeClasses(setting,node),fontStyle=[];for(var f in fontcss){fontStyle.push(f,":",fontcss[f],";")}html.push("<a id='",node.tId,consts.id.A,"' class='",consts.className.LEVEL,node.level,nodeClasses.add?" "+nodeClasses.add.join(" "):"","' treeNode",consts.id.A,' onclick="',(node.click||""),'" ',((url!=null&&url.length>0)?"href='"+url+"'":"")," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(""),"'");if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&title){html.push("title='",title.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}html.push(">")},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return(fontCss&&((typeof fontCss)!="function"))?fontCss:{}},makeNodeClasses:function(setting,node){var classes=tools.apply(setting.view.nodeClasses,[setting.treeId,node],setting.view.nodeClasses);return(classes&&(typeof classes!=="function"))?classes:{add:[],remove:[]}},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];if(!node.isAjaxing){var isParent=data.nodeIsParent(setting,node);icoCss[0]=(node.iconSkin?node.iconSkin+"_":"")+icoCss[0];if(isParent){icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{icoCss.push(consts.folder.DOCU)}}return consts.className.BUTTON+" "+icoCss.join("_")},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var isParent=data.nodeIsParent(setting,node);var icon=(isParent&&node.iconOpen&&node.iconClose)?(node.open?node.iconOpen:node.iconClose):node[setting.data.key.icon];if(icon){icoStyle.push("background:url(",icon,") 0 0 no-repeat;")}if(setting.view.showIcon==false||!tools.apply(setting.view.showIcon,[setting.treeId,node],true)){icoStyle.push("display:none;")}}return icoStyle.join("")},makeNodeLineClass:function(setting,node){var lineClass=[];if(setting.view.showLine){if(node.level==0&&node.isFirstNode&&node.isLastNode){lineClass.push(consts.line.ROOT)}else{if(node.level==0&&node.isFirstNode){lineClass.push(consts.line.ROOTS)}else{if(node.isLastNode){lineClass.push(consts.line.BOTTOM)}else{lineClass.push(consts.line.CENTER)}}}}else{lineClass.push(consts.line.NOLINE)}if(data.nodeIsParent(setting,node)){lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{lineClass.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(node)+lineClass.join("_")},makeNodeLineClassEx:function(node){return consts.className.BUTTON+" "+consts.className.LEVEL+node.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(node){return(node.target||"_blank")},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='",consts.className.LEVEL,node.level," ",view.makeUlLineClass(setting,node),"' style='display:",(node.open?"block":"none"),"'>");html.push(content);html.push("</ul>")},makeUlLineClass:function(setting,node){return((setting.view.showLine&&!node.isLastNode)?consts.line.LINE:"")},removeChildNodes:function(setting,node){if(!node){return}var nodes=data.nodeChildren(setting,node);if(!nodes){return}for(var i=0,l=nodes.length;i<l;i++){data.removeNodeCache(setting,nodes[i])}data.removeSelectedNode(setting);delete node[setting.data.key.children];if(!setting.data.keep.parent){data.nodeIsParent(setting,node,false);node.open=false;var tmp_switchObj=$$(node,consts.id.SWITCH,setting),tmp_icoObj=$$(node,consts.id.ICON,setting);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU);$$(node,consts.id.UL,setting).remove()}else{$$(node,consts.id.UL,setting).empty()}},scrollIntoView:function(setting,dom){if(!dom){return}if(typeof Element==="undefined"||typeof HTMLElement==="undefined"){var contRect=setting.treeObj.get(0).getBoundingClientRect(),findMeRect=dom.getBoundingClientRect();if(findMeRect.top<contRect.top||findMeRect.bottom>contRect.bottom||findMeRect.right>contRect.right||findMeRect.left<contRect.left){dom.scrollIntoView()}return}if(!Element.prototype.scrollIntoViewIfNeeded){Element.prototype.scrollIntoViewIfNeeded=function(centerIfNeeded){function makeRange(start,length){return{start:start,length:length,end:start+length}}function coverRange(inner,outer){if(false===centerIfNeeded||(outer.start<inner.end&&inner.start<outer.end)){return Math.max(inner.end-outer.length,Math.min(outer.start,inner.start))}return(inner.start+inner.end-outer.length)/2}function makePoint(x,y){return{x:x,y:y,translate:function translate(dX,dY){return makePoint(x+dX,y+dY)}}}function absolute(elem,pt){while(elem){pt=pt.translate(elem.offsetLeft,elem.offsetTop);elem=elem.offsetParent}return pt}var target=absolute(this,makePoint(0,0)),extent=makePoint(this.offsetWidth,this.offsetHeight),elem=this.parentNode,origin;while(elem instanceof HTMLElement){origin=absolute(elem,makePoint(elem.clientLeft,elem.clientTop));elem.scrollLeft=coverRange(makeRange(target.x-origin.x,extent.x),makeRange(elem.scrollLeft,elem.clientWidth));elem.scrollTop=coverRange(makeRange(target.y-origin.y,extent.y),makeRange(elem.scrollTop,elem.clientHeight));target=target.translate(-elem.scrollLeft,-elem.scrollTop);elem=elem.parentNode}}}dom.scrollIntoViewIfNeeded()},setFirstNode:function(setting,parentNode){var children=data.nodeChildren(setting,parentNode);if(children.length>0){children[0].isFirstNode=true}},setLastNode:function(setting,parentNode){var children=data.nodeChildren(setting,parentNode);if(children.length>0){children[children.length-1].isLastNode=true}},removeNode:function(setting,node){var root=data.getRoot(setting),parentNode=(node.parentTId)?node.getParentNode():root;node.isFirstNode=false;node.isLastNode=false;node.getPreNode=function(){return null};node.getNextNode=function(){return null};if(!data.getNodeCache(setting,node.tId)){return}$$(node,setting).remove();data.removeNodeCache(setting,node);data.removeSelectedNode(setting,node);var children=data.nodeChildren(setting,parentNode);for(var i=0,l=children.length;i<l;i++){if(children[i].tId==node.tId){children.splice(i,1);break}}view.setFirstNode(setting,parentNode);view.setLastNode(setting,parentNode);var tmp_ulObj,tmp_switchObj,tmp_icoObj,childLength=children.length;if(!setting.data.keep.parent&&childLength==0){data.nodeIsParent(setting,parentNode,false);parentNode.open=false;delete parentNode[setting.data.key.children];tmp_ulObj=$$(parentNode,consts.id.UL,setting);tmp_switchObj=$$(parentNode,consts.id.SWITCH,setting);tmp_icoObj=$$(parentNode,consts.id.ICON,setting);view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none")}else{if(setting.view.showLine&&childLength>0){var newLast=children[childLength-1];tmp_ulObj=$$(newLast,consts.id.UL,setting);tmp_switchObj=$$(newLast,consts.id.SWITCH,setting);tmp_icoObj=$$(newLast,consts.id.ICON,setting);if(parentNode==root){if(children.length==1){view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT)}else{var tmp_first_switchObj=$$(children[0],consts.id.SWITCH,setting);view.replaceSwitchClass(children[0],tmp_first_switchObj,consts.line.ROOTS);view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}}else{view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}tmp_ulObj.removeClass(consts.line.LINE)}}},replaceIcoClass:function(node,obj,newName){if(!obj||node.isAjaxing){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName;break}obj.attr("class",tmpList.join("_"))},replaceSwitchClass:function(node,obj,newName){if(!obj){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName;break}obj.attr("class",tmpList.join("_"));if(newName!==consts.folder.DOCU){obj.removeAttr("disabled")}else{obj.attr("disabled","disabled")}},selectNode:function(setting,node,addFlag){if(!addFlag){view.cancelPreSelectedNode(setting,null,node)}$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED);data.addSelectedNode(setting,node);setting.treeObj.trigger(consts.event.SELECTED,[setting.treeId,node])},setNodeFontCss:function(setting,treeNode){var aObj=$$(treeNode,consts.id.A,setting),fontCss=view.makeNodeFontCss(setting,treeNode);if(fontCss){aObj.css(fontCss)}},setNodeClasses:function(setting,treeNode){var aObj=$$(treeNode,consts.id.A,setting),classes=view.makeNodeClasses(setting,treeNode);if("add" in classes&&classes.add.length){aObj.addClass(classes.add.join(" "))}if("remove" in classes&&classes.remove.length){aObj.removeClass(classes.remove.join(" "))}},setNodeLineIcos:function(setting,node){if(!node){return}var switchObj=$$(node,consts.id.SWITCH,setting),ulObj=$$(node,consts.id.UL,setting),icoObj=$$(node,consts.id.ICON,setting),ulLine=view.makeUlLineClass(setting,node);if(ulLine.length==0){ulObj.removeClass(consts.line.LINE)}else{ulObj.addClass(ulLine)}switchObj.attr("class",view.makeNodeLineClass(setting,node));if(data.nodeIsParent(setting,node)){switchObj.removeAttr("disabled")}else{switchObj.attr("disabled","disabled")}icoObj.removeAttr("style");icoObj.attr("style",view.makeNodeIcoStyle(setting,node));icoObj.attr("class",view.makeNodeIcoClass(setting,node))},setNodeName:function(setting,node){var title=data.nodeTitle(setting,node),nObj=$$(node,consts.id.SPAN,setting);nObj.empty();if(setting.view.nameIsHTML){nObj.html(data.nodeName(setting,node))}else{nObj.text(data.nodeName(setting,node))}if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)){var aObj=$$(node,consts.id.A,setting);aObj.attr("title",!title?"":title)}},setNodeTarget:function(setting,node){var aObj=$$(node,consts.id.A,setting);aObj.attr("target",view.makeNodeTarget(node))},setNodeUrl:function(setting,node){var aObj=$$(node,consts.id.A,setting),url=view.makeNodeUrl(setting,node);if(url==null||url.length==0){aObj.removeAttr("href")}else{aObj.attr("href",url)}},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node)){view.expandCollapseNode(setting,node,!node.open)}else{if(setting.async.enable){if(!view.asyncNode(setting,node)){view.expandCollapseNode(setting,node,!node.open);return}}else{if(node){view.expandCollapseNode(setting,node,!node.open)}}}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o?o:null},destroy:function(treeId){if(!!treeId&&treeId.length>0){view.destroy(data.getSetting(treeId))}else{for(var s in settings){view.destroy(settings[s])}}},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(true,setting,zSetting);setting.treeId=obj.attr("id");setting.treeObj=obj;setting.treeObj.empty();settings[setting.treeId]=setting;if(typeof document.body.style.maxHeight==="undefined"){setting.view.expandSpeed=""}data.initRoot(setting);var root=data.getRoot(setting);zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[];if(setting.data.simpleData.enable){data.nodeChildren(setting,root,data.transformTozTreeFormat(setting,zNodes))}else{data.nodeChildren(setting,root,zNodes)}data.initCache(setting);event.unbindTree(setting);event.bindTree(setting);event.unbindEvent(setting);event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,index,newNodes,isSilent){if(!parentNode){parentNode=null}var isParent=data.nodeIsParent(setting,parentNode);if(parentNode&&!isParent&&setting.data.keep.leaf){return null}var i=parseInt(index,10);if(isNaN(i)){isSilent=!!newNodes;newNodes=index;index=-1}else{index=i}if(!newNodes){return null}var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,index,xNewNodes,(isSilent==true))}if(tools.canAsync(setting,parentNode)){view.asyncNode(setting,parentNode,isSilent,addCallback)}else{addCallback()}return xNewNodes},cancelSelectedNode:function(node){view.cancelPreSelectedNode(setting,node)},destroy:function(){view.destroy(setting)},expandAll:function(expandFlag){expandFlag=!!expandFlag;view.expandCollapseSonNode(setting,null,expandFlag,true);return expandFlag},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){if(!node||!data.nodeIsParent(setting,node)){return null}if(expandFlag!==true&&expandFlag!==false){expandFlag=!node.open}callbackFlag=!!callbackFlag;if(callbackFlag&&expandFlag&&(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)){return null}else{if(callbackFlag&&!expandFlag&&(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)){return null}}if(expandFlag&&node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,false)}if(expandFlag===node.open&&!sonSign){return null}data.getRoot(setting).expandTriggerFlag=callbackFlag;if(!tools.canAsync(setting,node)&&sonSign){view.expandCollapseSonNode(setting,node,expandFlag,true,showNodeFocus)}else{node.open=!expandFlag;view.switchNode(this.setting,node);showNodeFocus()}return expandFlag;function showNodeFocus(){var a=$$(node,setting).get(0);if(a&&focus!==false){view.scrollIntoView(setting,a)}}},getNodes:function(){return data.getNodes(setting)},getNodeByParam:function(key,value,parentNode){if(!key){return null}return data.getNodeByParam(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),key,value)},getNodeByTId:function(tId){return data.getNodeCache(setting,tId)},getNodesByParam:function(key,value,parentNode){if(!key){return null}return data.getNodesByParam(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),key,value)},getNodesByParamFuzzy:function(key,value,parentNode){if(!key){return null}return data.getNodesByParamFuzzy(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),key,value)},getNodesByFilter:function(filter,isSingle,parentNode,invokeParam){isSingle=!!isSingle;if(!filter||(typeof filter!="function")){return(isSingle?null:[])}return data.getNodesByFilter(setting,parentNode?data.nodeChildren(setting,parentNode):data.getNodes(setting),filter,isSingle,invokeParam)},getNodeIndex:function(node){if(!node){return null}var parentNode=(node.parentTId)?node.getParentNode():data.getRoot(setting);var children=data.nodeChildren(setting,parentNode);for(var i=0,l=children.length;i<l;i++){if(children[i]==node){return i}}return -1},getSelectedNodes:function(){var r=[],list=data.getRoot(setting).curSelectedList;for(var i=0,l=list.length;i<l;i++){r.push(list[i])}return r},isSelectedNode:function(node){return data.isSelectedNode(setting,node)},reAsyncChildNodesPromise:function(parentNode,reloadType,isSilent){var promise=new Promise(function(resolve,reject){try{zTreeTools.reAsyncChildNodes(parentNode,reloadType,isSilent,function(){resolve(parentNode)})}catch(e){reject(e)}});return promise},reAsyncChildNodes:function(parentNode,reloadType,isSilent,callback){if(!this.setting.async.enable){return}var isRoot=!parentNode;if(isRoot){parentNode=data.getRoot(setting)}if(reloadType=="refresh"){var children=data.nodeChildren(setting,parentNode);for(var i=0,l=children?children.length:0;i<l;i++){data.removeNodeCache(setting,children[i])}data.removeSelectedNode(setting);data.nodeChildren(setting,parentNode,[]);if(isRoot){this.setting.treeObj.empty()}else{var ulObj=$$(parentNode,consts.id.UL,setting);ulObj.empty()}}view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent,callback)},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(setting),nodes=data.nodeChildren(setting,root);data.initRoot(setting);data.nodeChildren(setting,root,nodes);data.initCache(setting);view.createNodes(setting,0,data.nodeChildren(setting,root),null,-1)},removeChildNodes:function(node){if(!node){return null}var nodes=data.nodeChildren(setting,node);view.removeChildNodes(setting,node);return nodes?nodes:null},removeNode:function(node,callbackFlag){if(!node){return}callbackFlag=!!callbackFlag;if(callbackFlag&&tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false){return}view.removeNode(setting,node);if(callbackFlag){this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node])}},selectNode:function(node,addFlag,isSilent){if(!node){return}if(tools.uCanDo(setting)){addFlag=setting.view.selectedMulti&&addFlag;if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),true,false,showNodeFocus)}else{if(!isSilent){try{$$(node,setting).focus().blur()}catch(e){}}}view.selectNode(setting,node,addFlag)}function showNodeFocus(){if(isSilent){return}var a=$$(node,setting).get(0);view.scrollIntoView(setting,a)}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(setting,simpleNodes)},transformToArray:function(nodes){return data.transformToArrayFormat(setting,nodes)},updateNode:function(node,checkTypeFlag){if(!node){return}var nObj=$$(node,setting);if(nObj.get(0)&&tools.uCanDo(setting)){view.setNodeName(setting,node);view.setNodeTarget(setting,node);view.setNodeUrl(setting,node);view.setNodeLineIcos(setting,node);view.setNodeFontCss(setting,node);view.setNodeClasses(setting,node)}}};root.treeTools=zTreeTools;data.setZTreeTools(setting,zTreeTools);var children=data.nodeChildren(setting,root);if(children&&children.length>0){view.createNodes(setting,0,children,null,-1)}else{if(setting.async.enable&&setting.async.url&&setting.async.url!==""){view.asyncNode(setting)}}return zTreeTools}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts})(jQuery);(function(f){var A={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},n={check:{enable:false,autoCheckTrigger:false,chkStyle:A.checkbox.STYLE,nocheckInherit:false,chkDisabledInherit:false,radioType:A.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},w=function(B){var C=z.getRoot(B);C.radioCheckedList=[]},d=function(B){},o=function(B){var C=B.treeObj,D=r.event;C.bind(D.CHECK,function(G,F,H,E){G.srcEvent=F;u.apply(B.callback.onCheck,[G,H,E])})},y=function(B){var C=B.treeObj,D=r.event;C.unbind(D.CHECK)},p=function(H){var I=H.target,K=z.getSetting(H.data.treeId),F="",C=null,D="",G="",B=null,E=null;if(u.eqs(H.type,"mouseover")){if(K.check.enable&&u.eqs(I.tagName,"span")&&I.getAttribute("treeNode"+r.id.CHECK)!==null){F=u.getNodeMainDom(I).id;D="mouseoverCheck"}}else{if(u.eqs(H.type,"mouseout")){if(K.check.enable&&u.eqs(I.tagName,"span")&&I.getAttribute("treeNode"+r.id.CHECK)!==null){F=u.getNodeMainDom(I).id;D="mouseoutCheck"}}else{if(u.eqs(H.type,"click")){if(K.check.enable&&u.eqs(I.tagName,"span")&&I.getAttribute("treeNode"+r.id.CHECK)!==null){F=u.getNodeMainDom(I).id;D="checkNode"}}}}if(F.length>0){C=z.getNodeCache(K,F);switch(D){case"checkNode":B=m.onCheckNode;break;case"mouseoverCheck":B=m.onMouseoverCheck;break;case"mouseoutCheck":B=m.onMouseoutCheck;break}}var J={stop:D==="checkNode",node:C,nodeEventType:D,nodeEventCallback:B,treeEventType:G,treeEventCallback:E};return J},v=function(J,C,E,F,H,G,D){if(!E){return}var I=z.nodeChecked(J,E);E.checkedOld=I;if(typeof E.nocheck=="string"){E.nocheck=u.eqs(E.nocheck,"true")}E.nocheck=!!E.nocheck||(J.check.nocheckInherit&&F&&!!F.nocheck);if(typeof E.chkDisabled=="string"){E.chkDisabled=u.eqs(E.chkDisabled,"true")}E.chkDisabled=!!E.chkDisabled||(J.check.chkDisabledInherit&&F&&!!F.chkDisabled);if(typeof E.halfCheck=="string"){E.halfCheck=u.eqs(E.halfCheck,"true")}E.halfCheck=!!E.halfCheck;E.check_Child_State=-1;E.check_Focus=false;E.getCheckStatus=function(){return z.getCheckStatus(J,E)};if(J.check.chkStyle==r.radio.STYLE&&J.check.radioType==r.radio.TYPE_ALL&&I){var B=z.getRoot(J);B.radioCheckedList.push(E)}},a=function(C,D,B){if(C.check.enable){z.makeChkFlag(C,D);B.push("<span ID='",D.tId,r.id.CHECK,"' class='",k.makeChkClass(C,D),"' treeNode",r.id.CHECK,(D.nocheck===true?" style='display:none;'":""),"></span>")}},l=function(D,C){C.checkNode=function(I,H,J,G){var E=z.nodeChecked(D,I);if(I.chkDisabled===true){return}if(H!==true&&H!==false){H=!E}G=!!G;if(E===H&&!J){return}else{if(G&&u.apply(this.setting.callback.beforeCheck,[this.setting.treeId,I],true)==false){return}}if(u.uCanDo(this.setting)&&this.setting.check.enable&&I.nocheck!==true){z.nodeChecked(D,I,H);var F=j(I,r.id.CHECK,this.setting);if(J||this.setting.check.chkStyle===r.radio.STYLE){k.checkNodeRelation(this.setting,I)}k.setChkClass(this.setting,F,I);k.repairParentChkClassWithSelf(this.setting,I);if(G){this.setting.treeObj.trigger(r.event.CHECK,[null,this.setting.treeId,I])}}};C.checkAllNodes=function(E){k.repairAllChk(this.setting,!!E)};C.getCheckedNodes=function(F){F=(F!==false);var E=z.nodeChildren(D,z.getRoot(this.setting));return z.getTreeCheckedNodes(this.setting,E,F)};C.getChangeCheckedNodes=function(){var E=z.nodeChildren(D,z.getRoot(this.setting));return z.getTreeChangeCheckedNodes(this.setting,E)};C.setChkDisabled=function(F,E,G,H){E=!!E;G=!!G;H=!!H;k.repairSonChkDisabled(this.setting,F,E,H);k.repairParentChkDisabled(this.setting,F.getParentNode(),E,G)};var B=C.updateNode;C.updateNode=function(G,H){if(B){B.apply(C,arguments)}if(!G||!this.setting.check.enable){return}var E=j(G,this.setting);if(E.get(0)&&u.uCanDo(this.setting)){var F=j(G,r.id.CHECK,this.setting);if(H==true||this.setting.check.chkStyle===r.radio.STYLE){k.checkNodeRelation(this.setting,G)}k.setChkClass(this.setting,F,G);k.repairParentChkClassWithSelf(this.setting,G)}}},q={getRadioCheckedList:function(E){var D=z.getRoot(E).radioCheckedList;for(var C=0,B=D.length;C<B;C++){if(!z.getNodeCache(E,D[C].tId)){D.splice(C,1);C--;B--}}return D},getCheckStatus:function(B,E){if(!B.check.enable||E.nocheck||E.chkDisabled){return null}var D=z.nodeChecked(B,E),C={checked:D,half:E.halfCheck?E.halfCheck:(B.check.chkStyle==r.radio.STYLE?(E.check_Child_State===2):(D?(E.check_Child_State>-1&&E.check_Child_State<2):(E.check_Child_State>0)))};return C},getTreeCheckedNodes:function(K,B,J,G){if(!B){return[]}var I=(J&&K.check.chkStyle==r.radio.STYLE&&K.check.radioType==r.radio.TYPE_ALL);G=!G?[]:G;for(var H=0,F=B.length;H<F;H++){var D=B[H];var C=z.nodeChildren(K,D);var E=z.nodeChecked(K,D);if(D.nocheck!==true&&D.chkDisabled!==true&&E==J){G.push(D);if(I){break}}z.getTreeCheckedNodes(K,C,J,G);if(I&&G.length>0){break}}return G},getTreeChangeCheckedNodes:function(H,D,G){if(!D){return[]}G=!G?[]:G;for(var F=0,C=D.length;F<C;F++){var I=D[F];var E=z.nodeChildren(H,I);var B=z.nodeChecked(H,I);if(I.nocheck!==true&&I.chkDisabled!==true&&B!=I.checkedOld){G.push(I)}z.getTreeChangeCheckedNodes(H,E,G)}return G},makeChkFlag:function(I,C){if(!C){return}var F=-1;var B=z.nodeChildren(I,C);if(B){for(var H=0,D=B.length;H<D;H++){var J=B[H];var E=z.nodeChecked(I,J);var G=-1;if(I.check.chkStyle==r.radio.STYLE){if(J.nocheck===true||J.chkDisabled===true){G=J.check_Child_State}else{if(J.halfCheck===true){G=2}else{if(E){G=2}else{G=J.check_Child_State>0?2:0}}}if(G==2){F=2;break}else{if(G==0){F=0}}}else{if(I.check.chkStyle==r.checkbox.STYLE){if(J.nocheck===true||J.chkDisabled===true){G=J.check_Child_State}else{if(J.halfCheck===true){G=1}else{if(E){G=(J.check_Child_State===-1||J.check_Child_State===2)?2:1}else{G=(J.check_Child_State>0)?1:0}}}if(G===1){F=1;break}else{if(G===2&&F>-1&&H>0&&G!==F){F=1;break}else{if(F===2&&G>-1&&G<2){F=1;break}else{if(G>-1){F=G}}}}}}}}C.check_Child_State=F}},h={},m={onCheckNode:function(F,E){if(E.chkDisabled===true){return false}var D=z.getSetting(F.data.treeId);if(u.apply(D.callback.beforeCheck,[D.treeId,E],true)==false){return true}var B=z.nodeChecked(D,E);z.nodeChecked(D,E,!B);k.checkNodeRelation(D,E);var C=j(E,r.id.CHECK,D);k.setChkClass(D,C,E);k.repairParentChkClassWithSelf(D,E);D.treeObj.trigger(r.event.CHECK,[F,D.treeId,E]);return true},onMouseoverCheck:function(E,D){if(D.chkDisabled===true){return false}var C=z.getSetting(E.data.treeId),B=j(D,r.id.CHECK,C);D.check_Focus=true;k.setChkClass(C,B,D);return true},onMouseoutCheck:function(E,D){if(D.chkDisabled===true){return false}var C=z.getSetting(E.data.treeId),B=j(D,r.id.CHECK,C);D.check_Focus=false;k.setChkClass(C,B,D);return true}},i={},e={checkNodeRelation:function(K,D){var I,G,E,B=r.radio;var F=z.nodeChecked(K,D);if(K.check.chkStyle==B.STYLE){var L=z.getRadioCheckedList(K);if(F){if(K.check.radioType==B.TYPE_ALL){for(G=L.length-1;G>=0;G--){I=L[G];var J=z.nodeChecked(K,I);if(J&&I!=D){z.nodeChecked(K,I,false);L.splice(G,1);k.setChkClass(K,j(I,r.id.CHECK,K),I);if(I.parentTId!=D.parentTId){k.repairParentChkClassWithSelf(K,I)}}}L.push(D)}else{var H=(D.parentTId)?D.getParentNode():z.getRoot(K);var C=z.nodeChildren(K,H);for(G=0,E=C.length;G<E;G++){I=C[G];var J=z.nodeChecked(K,I);if(J&&I!=D){z.nodeChecked(K,I,false);k.setChkClass(K,j(I,r.id.CHECK,K),I)}}}}else{if(K.check.radioType==B.TYPE_ALL){for(G=0,E=L.length;G<E;G++){if(D==L[G]){L.splice(G,1);break}}}}}else{var C=z.nodeChildren(K,D);if(F&&(!C||C.length==0||K.check.chkboxType.Y.indexOf("s")>-1)){k.setSonNodeCheckBox(K,D,true)}if(!F&&(!C||C.length==0||K.check.chkboxType.N.indexOf("s")>-1)){k.setSonNodeCheckBox(K,D,false)}if(F&&K.check.chkboxType.Y.indexOf("p")>-1){k.setParentNodeCheckBox(K,D,true)}if(!F&&K.check.chkboxType.N.indexOf("p")>-1){k.setParentNodeCheckBox(K,D,false)}}},makeChkClass:function(C,F){var H=r.checkbox,E=r.radio,G="";var B=z.nodeChecked(C,F);if(F.chkDisabled===true){G=H.DISABLED}else{if(F.halfCheck){G=H.PART}else{if(C.check.chkStyle==E.STYLE){G=(F.check_Child_State<1)?H.FULL:H.PART}else{G=B?((F.check_Child_State===2||F.check_Child_State===-1)?H.FULL:H.PART):((F.check_Child_State<1)?H.FULL:H.PART)}}}var D=C.check.chkStyle+"_"+(B?H.TRUE:H.FALSE)+"_"+G;D=(F.check_Focus&&F.chkDisabled!==true)?D+"_"+H.FOCUS:D;return r.className.BUTTON+" "+H.DEFAULT+" "+D},repairAllChk:function(F,H){if(F.check.enable&&F.check.chkStyle===r.checkbox.STYLE){var C=z.getRoot(F);var E=z.nodeChildren(F,C);for(var D=0,B=E.length;D<B;D++){var G=E[D];if(G.nocheck!==true&&G.chkDisabled!==true){z.nodeChecked(F,G,H)}k.setSonNodeCheckBox(F,G,H)}}},repairChkClass:function(C,D){if(!D){return}z.makeChkFlag(C,D);if(D.nocheck!==true){var B=j(D,r.id.CHECK,C);k.setChkClass(C,B,D)}},repairParentChkClass:function(C,D){if(!D||!D.parentTId){return}var B=D.getParentNode();k.repairChkClass(C,B);k.repairParentChkClass(C,B)},repairParentChkClassWithSelf:function(C,D){if(!D){return}var B=z.nodeChildren(C,D);if(B&&B.length>0){k.repairParentChkClass(C,B[0])}else{k.repairParentChkClass(C,D)}},repairSonChkDisabled:function(H,I,G,D){if(!I){return}if(I.chkDisabled!=G){I.chkDisabled=G}k.repairChkClass(H,I);var F=z.nodeChildren(H,I);if(F&&D){for(var E=0,C=F.length;E<C;E++){var B=F[E];k.repairSonChkDisabled(H,B,G,D)}}},repairParentChkDisabled:function(D,E,C,B){if(!E){return}if(E.chkDisabled!=C&&B){E.chkDisabled=C}k.repairChkClass(D,E);k.repairParentChkDisabled(D,E.getParentNode(),C,B)},setChkClass:function(B,D,C){if(!D){return}if(C.nocheck===true){D.hide()}else{D.show()}D.attr("class",k.makeChkClass(B,C))},setParentNodeCheckBox:function(L,C,J,G){var H=j(C,r.id.CHECK,L);if(!G){G=C}z.makeChkFlag(L,C);if(C.nocheck!==true&&C.chkDisabled!==true){z.nodeChecked(L,C,J);k.setChkClass(L,H,C);if(L.check.autoCheckTrigger&&C!=G){L.treeObj.trigger(r.event.CHECK,[null,L.treeId,C])}}if(C.parentTId){var I=true;if(!J){var B=z.nodeChildren(L,C.getParentNode());for(var F=0,E=B.length;F<E;F++){var K=B[F];var D=z.nodeChecked(L,K);if((K.nocheck!==true&&K.chkDisabled!==true&&D)||((K.nocheck===true||K.chkDisabled===true)&&K.check_Child_State>0)){I=false;break}}}if(I){k.setParentNodeCheckBox(L,C.getParentNode(),J,G)}}},setSonNodeCheckBox:function(K,D,J,G){if(!D){return}var H=j(D,r.id.CHECK,K);if(!G){G=D}var B=false;var C=z.nodeChildren(K,D);if(C){for(var F=0,E=C.length;F<E;F++){var I=C[F];k.setSonNodeCheckBox(K,I,J,G);if(I.chkDisabled===true){B=true}}}if(D!=z.getRoot(K)&&D.chkDisabled!==true){if(B&&D.nocheck!==true){z.makeChkFlag(K,D)}if(D.nocheck!==true&&D.chkDisabled!==true){z.nodeChecked(K,D,J);if(!B){D.check_Child_State=(C&&C.length>0)?(J?2:0):-1}}else{D.check_Child_State=-1}k.setChkClass(K,H,D);if(K.check.autoCheckTrigger&&D!=G&&D.nocheck!==true&&D.chkDisabled!==true){K.treeObj.trigger(r.event.CHECK,[null,K.treeId,D])}}}},t={tools:i,view:e,event:h,data:q};f.extend(true,f.fn.zTree.consts,A);f.extend(true,f.fn.zTree._z,t);var c=f.fn.zTree,u=c._z.tools,r=c.consts,k=c._z.view,z=c._z.data,s=c._z.event,j=u.$;z.nodeChecked=function(D,E,B){if(!E){return false}var C=D.data.key.checked;if(typeof B!=="undefined"){if(typeof B==="string"){B=u.eqs(B,"true")}B=!!B;E[C]=B}else{if(typeof E[C]=="string"){E[C]=u.eqs(E[C],"true")}else{E[C]=!!E[C]}}return E[C]};z.exSetting(n);z.addInitBind(o);z.addInitUnBind(y);z.addInitCache(d);z.addInitNode(v);z.addInitProxy(p,true);z.addInitRoot(w);z.addBeforeA(a);z.addZTreeTools(l);var x=k.createNodes;k.createNodes=function(E,F,C,B,D){if(x){x.apply(k,arguments)}if(!C){return}k.repairParentChkClassWithSelf(E,B)};var b=k.removeNode;k.removeNode=function(C,D){var B=D.getParentNode();if(b){b.apply(k,arguments)}if(!D||!B){return}k.repairChkClass(C,B);k.repairParentChkClass(C,B)};var g=k.appendNodes;k.appendNodes=function(G,I,C,B,D,F,H){var E="";if(g){E=g.apply(k,arguments)}if(B){z.makeChkFlag(G,B)}return E}})(jQuery);(function(f){var C={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},m={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},x=function(E){var F=A.getRoot(E),D=A.getRoots();F.curEditNode=null;F.curEditInput=null;F.curHoverNode=null;F.dragFlag=0;F.dragNodeShowBefore=[];F.dragMaskList=new Array();D.showHoverDom=true},c=function(D){},n=function(D){var E=D.treeObj;var F=q.event;E.bind(F.RENAME,function(H,J,I,G){v.apply(D.callback.onRename,[H,J,I,G])});E.bind(F.DRAG,function(H,G,J,I){v.apply(D.callback.onDrag,[G,J,I])});E.bind(F.DRAGMOVE,function(H,G,J,I){v.apply(D.callback.onDragMove,[G,J,I])});E.bind(F.DROP,function(J,I,L,K,M,H,G){v.apply(D.callback.onDrop,[I,L,K,M,H,G])})},z=function(D){var E=D.treeObj;var F=q.event;E.unbind(F.RENAME);E.unbind(F.DRAG);E.unbind(F.DRAGMOVE);E.unbind(F.DROP)},o=function(K){var L=K.target,O=A.getSetting(K.data.treeId),M=K.relatedTarget,I="",E=null,F="",J="",D=null,H=null,G=null;if(v.eqs(K.type,"mouseover")){G=v.getMDom(O,L,[{tagName:"a",attrName:"treeNode"+q.id.A}]);if(G){I=v.getNodeMainDom(G).id;F="hoverOverNode"}}else{if(v.eqs(K.type,"mouseout")){G=v.getMDom(O,M,[{tagName:"a",attrName:"treeNode"+q.id.A}]);if(!G){I="remove";F="hoverOutNode"}}else{if(v.eqs(K.type,"mousedown")){G=v.getMDom(O,L,[{tagName:"a",attrName:"treeNode"+q.id.A}]);if(G){I=v.getNodeMainDom(G).id;F="mousedownNode"}}}}if(I.length>0){E=A.getNodeCache(O,I);switch(F){case"mousedownNode":D=l.onMousedownNode;break;case"hoverOverNode":D=l.onHoverOverNode;break;case"hoverOutNode":D=l.onHoverOutNode;break}}var N={stop:false,node:E,nodeEventType:F,nodeEventCallback:D,treeEventType:J,treeEventCallback:H};return N},w=function(F,J,I,D,H,E,G){if(!I){return}I.isHover=false;I.editNameFlag=false},k=function(E,D){D.cancelEditName=function(G){var F=A.getRoot(this.setting);if(!F.curEditNode){return}j.cancelCurEditNode(this.setting,G?G:null,true)};D.copyNode=function(K,J,I,M){if(!J){return null}var F=A.nodeIsParent(E,K);if(K&&!F&&this.setting.data.keep.leaf&&I===q.move.TYPE_INNER){return null}var L=this,G=v.clone(J);if(!K){K=null;I=q.move.TYPE_INNER}if(I==q.move.TYPE_INNER){function H(){j.addNodes(L.setting,K,-1,[G],M)}if(v.canAsync(this.setting,K)){j.asyncNode(this.setting,K,M,H)}else{H()}}else{j.addNodes(this.setting,K.parentNode,-1,[G],M);j.moveNode(this.setting,K,G,I,false,M)}return G};D.editName=function(F){if(!F||!F.tId||F!==A.getNodeCache(this.setting,F.tId)){return}if(F.parentTId){j.expandCollapseParentNode(this.setting,F.getParentNode(),true)}j.editNode(this.setting,F)};D.moveNode=function(I,H,G,L){if(!H){return H}var F=A.nodeIsParent(E,I);if(I&&!F&&this.setting.data.keep.leaf&&G===q.move.TYPE_INNER){return null}else{if(I&&((H.parentTId==I.tId&&G==q.move.TYPE_INNER)||i(H,this.setting).find("#"+I.tId).length>0)){return null}else{if(!I){I=null}}}var K=this;function J(){j.moveNode(K.setting,I,H,G,false,L)}if(v.canAsync(this.setting,I)&&G===q.move.TYPE_INNER){j.asyncNode(this.setting,I,L,J)}else{J()}return H};D.setEditable=function(F){this.setting.edit.enable=F;return this.refresh()}},p={setSonNodeLevel:function(H,D,I){if(!I){return}var G=A.nodeChildren(H,I);I.level=(D)?D.level+1:0;if(!G){return}for(var F=0,E=G.length;F<E;F++){if(G[F]){A.setSonNodeLevel(H,I,G[F])}}}},g={},l={onHoverOverNode:function(G,F){var E=A.getSetting(G.data.treeId),D=A.getRoot(E);if(D.curHoverNode!=F){l.onHoverOutNode(G)}D.curHoverNode=F;j.addHoverDom(E,F)},onHoverOutNode:function(G,F){var E=A.getSetting(G.data.treeId),D=A.getRoot(E);if(D.curHoverNode&&!A.isSelectedNode(E,D.curHoverNode)){j.removeTreeDom(E,D.curHoverNode);D.curHoverNode=null}},onMousedownNode:function(S,K){var aa,X,R=A.getSetting(S.data.treeId),W=A.getRoot(R),L=A.getRoots();if(S.button==2||!R.edit.enable||(!R.edit.drag.isCopy&&!R.edit.drag.isMove)){return true}var ad=S.target,J=A.getRoot(R).curSelectedList,T=[];if(!A.isSelectedNode(R,K)){T=[K]}else{for(aa=0,X=J.length;aa<X;aa++){if(J[aa].editNameFlag&&v.eqs(ad.tagName,"input")&&ad.getAttribute("treeNode"+q.id.INPUT)!==null){return true}T.push(J[aa]);if(T[0].parentTId!==J[aa].parentTId){T=[K];break}}}j.editNodeBlur=true;j.cancelCurEditNode(R);var ag=f(R.treeObj.get(0).ownerDocument),M=f(R.treeObj.get(0).ownerDocument.body),Z,N,ab,ac=false,ae=R,I=R,D,H,U=null,G=null,Q=null,E=q.move.TYPE_INNER,Y=S.clientX,V=S.clientY,O=(new Date()).getTime();if(v.uCanDo(R)){ag.bind("mousemove",P)}function P(a5){if(W.dragFlag==0&&Math.abs(Y-a5.clientX)<R.edit.drag.minMoveSize&&Math.abs(V-a5.clientY)<R.edit.drag.minMoveSize){return true}var aZ,aV,ay,aQ,aJ;M.css("cursor","pointer");if(W.dragFlag==0){if(v.apply(R.callback.beforeDrag,[R.treeId,T],true)==false){af(a5);return true}for(aZ=0,aV=T.length;aZ<aV;aZ++){if(aZ==0){W.dragNodeShowBefore=[]}ay=T[aZ];if(A.nodeIsParent(R,ay)&&ay.open){j.expandCollapseNode(R,ay,!ay.open);W.dragNodeShowBefore[ay.tId]=true}else{W.dragNodeShowBefore[ay.tId]=false}}W.dragFlag=1;L.showHoverDom=false;v.showIfameMask(R,true);var ai=true,al=-1;if(T.length>1){var aw=T[0].parentTId?A.nodeChildren(R,T[0].getParentNode()):A.getNodes(R);aJ=[];for(aZ=0,aV=aw.length;aZ<aV;aZ++){if(W.dragNodeShowBefore[aw[aZ].tId]!==undefined){if(ai&&al>-1&&(al+1)!==aZ){ai=false}aJ.push(aw[aZ]);al=aZ}if(T.length===aJ.length){T=aJ;break}}}if(ai){D=T[0].getPreNode();H=T[T.length-1].getNextNode()}Z=i("<ul class='zTreeDragUL'></ul>",R);for(aZ=0,aV=T.length;aZ<aV;aZ++){ay=T[aZ];ay.editNameFlag=false;j.selectNode(R,ay,aZ>0);j.removeTreeDom(R,ay);if(aZ>R.edit.drag.maxShowNodeNum-1){continue}aQ=i("<li id='"+ay.tId+"_tmp'></li>",R);aQ.append(i(ay,q.id.A,R).clone());aQ.css("padding","0");aQ.children("#"+ay.tId+q.id.A).removeClass(q.node.CURSELECTED);Z.append(aQ);if(aZ==R.edit.drag.maxShowNodeNum-1){aQ=i("<li id='"+ay.tId+"_moretmp'><a>  ...  </a></li>",R);Z.append(aQ)}}Z.attr("id",T[0].tId+q.id.UL+"_tmp");Z.addClass(R.treeObj.attr("class"));Z.appendTo(M);N=i("<span class='tmpzTreeMove_arrow'></span>",R);N.attr("id","zTreeMove_arrow_tmp");N.appendTo(M);R.treeObj.trigger(q.event.DRAG,[a5,R.treeId,T])}if(W.dragFlag==1){if(ab&&N.attr("id")==a5.target.id&&Q&&(a5.clientX+ag.scrollLeft()+2)>(f("#"+Q+q.id.A,ab).offset().left)){var a4=f("#"+Q+q.id.A,ab);a5.target=(a4.length>0)?a4.get(0):a5.target}else{if(ab){ab.removeClass(q.node.TMPTARGET_TREE);if(Q){f("#"+Q+q.id.A,ab).removeClass(q.node.TMPTARGET_NODE+"_"+q.move.TYPE_PREV).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_NEXT).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_INNER)}}}ab=null;Q=null;ac=false;ae=R;var a0=A.getSettings();for(var aR in a0){if(a0[aR].treeId&&a0[aR].edit.enable&&a0[aR].treeId!=R.treeId&&(a5.target.id==a0[aR].treeId||f(a5.target).parents("#"+a0[aR].treeId).length>0)){ac=true;ae=a0[aR]}}var av=ag.scrollTop(),a3=ag.scrollLeft(),aj=ae.treeObj.offset(),aD=ae.treeObj.get(0).scrollHeight,aS=ae.treeObj.get(0).scrollWidth,a1=(a5.clientY+av-aj.top),aP=(ae.treeObj.height()+aj.top-a5.clientY-av),aK=(a5.clientX+a3-aj.left),au=(ae.treeObj.width()+aj.left-a5.clientX-a3),ax=(a1<R.edit.drag.borderMax&&a1>R.edit.drag.borderMin),a6=(aP<R.edit.drag.borderMax&&aP>R.edit.drag.borderMin),aN=(aK<R.edit.drag.borderMax&&aK>R.edit.drag.borderMin),ar=(au<R.edit.drag.borderMax&&au>R.edit.drag.borderMin),ak=a1>R.edit.drag.borderMin&&aP>R.edit.drag.borderMin&&aK>R.edit.drag.borderMin&&au>R.edit.drag.borderMin,aH=(ax&&ae.treeObj.scrollTop()<=0),aG=(a6&&(ae.treeObj.scrollTop()+ae.treeObj.height()+10)>=aD),an=(aN&&ae.treeObj.scrollLeft()<=0),aB=(ar&&(ae.treeObj.scrollLeft()+ae.treeObj.width()+10)>=aS);if(a5.target&&v.isChildOrSelf(a5.target,ae.treeId)){var at=a5.target;while(at&&at.tagName&&!v.eqs(at.tagName,"li")&&at.id!=ae.treeId){at=at.parentNode}var aA=true;for(aZ=0,aV=T.length;aZ<aV;aZ++){ay=T[aZ];if(at.id===ay.tId){aA=false;break}else{if(i(ay,R).find("#"+at.id).length>0){aA=false;break}}}if(aA&&a5.target&&v.isChildOrSelf(a5.target,at.id+q.id.A)){ab=f(at);Q=at.id}}ay=T[0];if(ak&&v.isChildOrSelf(a5.target,ae.treeId)){if(!ab&&(a5.target.id==ae.treeId||aH||aG||an||aB)&&(ac||(!ac&&ay.parentTId))){ab=ae.treeObj}if(ax){ae.treeObj.scrollTop(ae.treeObj.scrollTop()-10)}else{if(a6){ae.treeObj.scrollTop(ae.treeObj.scrollTop()+10)}}if(aN){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()-10)}else{if(ar){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+10)}}if(ab&&ab!=ae.treeObj&&ab.offset().left<ae.treeObj.offset().left){ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+ab.offset().left-ae.treeObj.offset().left)}}Z.css({top:(a5.clientY+av+3)+"px",left:(a5.clientX+a3+3)+"px"});var aF=0;var aE=0;if(ab&&ab.attr("id")!=ae.treeId){var aO=Q==null?null:A.getNodeCache(ae,Q),aI=((a5.ctrlKey||a5.metaKey)&&R.edit.drag.isMove&&R.edit.drag.isCopy)||(!R.edit.drag.isMove&&R.edit.drag.isCopy),ap=!!(D&&Q===D.tId),aM=!!(H&&Q===H.tId),aX=(ay.parentTId&&ay.parentTId==Q),aL=(aI||!aM)&&v.apply(ae.edit.drag.prev,[ae.treeId,T,aO],!!ae.edit.drag.prev),ao=(aI||!ap)&&v.apply(ae.edit.drag.next,[ae.treeId,T,aO],!!ae.edit.drag.next),ah=(aI||!aX)&&!(ae.data.keep.leaf&&!A.nodeIsParent(R,aO))&&v.apply(ae.edit.drag.inner,[ae.treeId,T,aO],!!ae.edit.drag.inner);function a2(){ab=null;Q="";E=q.move.TYPE_INNER;N.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}if(!aL&&!ao&&!ah){a2()}else{var aC=f("#"+Q+q.id.A,ab),aU=aO.isLastNode?null:f("#"+aO.getNextNode().tId+q.id.A,ab.next()),aW=aC.offset().top,aY=aC.offset().left,aT=aL?(ah?0.25:(ao?0.5:1)):-1,aq=ao?(ah?0.75:(aL?0.5:0)):-1,am=(a5.clientY+av-aW)/aC.height();if((aT==1||am<=aT&&am>=-0.2)&&aL){aF=1-N.width();aE=aW-N.height()/2;E=q.move.TYPE_PREV}else{if((aq==0||am>=aq&&am<=1.2)&&ao){aF=1-N.width();aE=(aU==null||(A.nodeIsParent(R,aO)&&aO.open))?(aW+aC.height()-N.height()/2):(aU.offset().top-N.height()/2);E=q.move.TYPE_NEXT}else{if(ah){aF=5-N.width();aE=aW;E=q.move.TYPE_INNER}else{a2()}}}if(ab){N.css({display:"block",top:aE+"px",left:(aY+aF)+"px"});aC.addClass(q.node.TMPTARGET_NODE+"_"+E);if(U!=Q||G!=E){O=(new Date()).getTime()}if(aO&&A.nodeIsParent(R,aO)&&E==q.move.TYPE_INNER){var az=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==aO.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===aO.tId){az=false}}if(az){window.zTreeMoveTimer=setTimeout(function(){if(E!=q.move.TYPE_INNER){return}if(aO&&A.nodeIsParent(R,aO)&&!aO.open&&(new Date()).getTime()-O>ae.edit.drag.autoOpenTime&&v.apply(ae.callback.beforeDragOpen,[ae.treeId,aO],true)){j.switchNode(ae,aO);if(ae.edit.drag.autoExpandTrigger){ae.treeObj.trigger(q.event.EXPAND,[ae.treeId,aO])}}},ae.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=aO.tId}}}}}else{E=q.move.TYPE_INNER;if(ab&&v.apply(ae.edit.drag.inner,[ae.treeId,T,null],!!ae.edit.drag.inner)){ab.addClass(q.node.TMPTARGET_TREE)}else{ab=null}N.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}U=Q;G=E;R.treeObj.trigger(q.event.DRAGMOVE,[a5,R.treeId,T])}return false}ag.bind("mouseup",af);function af(ao){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}U=null;G=null;ag.unbind("mousemove",P);ag.unbind("mouseup",af);ag.unbind("selectstart",F);M.css("cursor","");if(ab){ab.removeClass(q.node.TMPTARGET_TREE);if(Q){f("#"+Q+q.id.A,ab).removeClass(q.node.TMPTARGET_NODE+"_"+q.move.TYPE_PREV).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_NEXT).removeClass(q.node.TMPTARGET_NODE+"_"+C.move.TYPE_INNER)}}v.showIfameMask(R,false);L.showHoverDom=true;if(W.dragFlag==0){return}W.dragFlag=0;var am,ai,an;for(am=0,ai=T.length;am<ai;am++){an=T[am];if(A.nodeIsParent(R,an)&&W.dragNodeShowBefore[an.tId]&&!an.open){j.expandCollapseNode(R,an,!an.open);delete W.dragNodeShowBefore[an.tId]}}if(Z){Z.remove()}if(N){N.remove()}var ah=((ao.ctrlKey||ao.metaKey)&&R.edit.drag.isMove&&R.edit.drag.isCopy)||(!R.edit.drag.isMove&&R.edit.drag.isCopy);if(!ah&&ab&&Q&&T[0].parentTId&&Q==T[0].parentTId&&E==q.move.TYPE_INNER){ab=null}if(ab){var aj=Q==null?null:A.getNodeCache(ae,Q);if(v.apply(R.callback.beforeDrop,[ae.treeId,T,aj,E,ah],true)==false){j.selectNodes(I,T);return}var ak=ah?v.clone(T):T;function al(){if(ac){if(!ah){for(var ar=0,aq=T.length;ar<aq;ar++){j.removeNode(R,T[ar])}}if(E==q.move.TYPE_INNER){j.addNodes(ae,aj,-1,ak)}else{j.addNodes(ae,aj.getParentNode(),E==q.move.TYPE_PREV?aj.getIndex():aj.getIndex()+1,ak)}}else{if(ah&&E==q.move.TYPE_INNER){j.addNodes(ae,aj,-1,ak)}else{if(ah){j.addNodes(ae,aj.getParentNode(),E==q.move.TYPE_PREV?aj.getIndex():aj.getIndex()+1,ak)}else{if(E!=q.move.TYPE_NEXT){for(ar=0,aq=ak.length;ar<aq;ar++){j.moveNode(ae,aj,ak[ar],E,false)}}else{for(ar=-1,aq=ak.length-1;ar<aq;aq--){j.moveNode(ae,aj,ak[aq],E,false)}}}}}j.selectNodes(ae,ak);var ap=i(ak[0],R).get(0);j.scrollIntoView(R,ap);R.treeObj.trigger(q.event.DROP,[ao,ae.treeId,ak,aj,E,ah])}if(E==q.move.TYPE_INNER&&v.canAsync(ae,aj)){j.asyncNode(ae,aj,false,al)}else{al()}}else{j.selectNodes(I,T);R.treeObj.trigger(q.event.DROP,[ao,R.treeId,T,null,null,null])}}ag.bind("selectstart",F);function F(){return false}return true}},h={getAbs:function(E){var G=E.getBoundingClientRect(),D=document.body.scrollTop+document.documentElement.scrollTop,F=document.body.scrollLeft+document.documentElement.scrollLeft;return[G.left+F,G.top+D]},inputFocus:function(D){if(D.get(0)){D.focus();v.setCursorPosition(D.get(0),D.val().length)}},inputSelect:function(D){if(D.get(0)){D.focus();D.select()}},setCursorPosition:function(E,F){if(E.setSelectionRange){E.focus();E.setSelectionRange(F,F)}else{if(E.createTextRange){var D=E.createTextRange();D.collapse(true);D.moveEnd("character",F);D.moveStart("character",F);D.select()}}},showIfameMask:function(K,I){var H=A.getRoot(K);while(H.dragMaskList.length>0){H.dragMaskList[0].remove();H.dragMaskList.shift()}if(I){var L=i("iframe",K);for(var G=0,E=L.length;G<E;G++){var F=L.get(G),D=v.getAbs(F),J=i("<div id='zTreeMask_"+G+"' class='zTreeMask' style='top:"+D[1]+"px; left:"+D[0]+"px; width:"+F.offsetWidth+"px; height:"+F.offsetHeight+"px;'></div>",K);J.appendTo(i("body",K));H.dragMaskList.push(J)}}}},d={addEditBtn:function(E,F){if(F.editNameFlag||i(F,q.id.EDIT,E).length>0){return}if(!v.apply(E.edit.showRenameBtn,[E.treeId,F],E.edit.showRenameBtn)){return}var G=i(F,q.id.A,E),D="<span class='"+q.className.BUTTON+" edit' id='"+F.tId+q.id.EDIT+"' title='"+v.apply(E.edit.renameTitle,[E.treeId,F],E.edit.renameTitle)+"' treeNode"+q.id.EDIT+" style='display:none;'></span>";G.append(D);i(F,q.id.EDIT,E).bind("click",function(){if(!v.uCanDo(E)||v.apply(E.callback.beforeEditName,[E.treeId,F],true)==false){return false}j.editNode(E,F);return false}).show()},addRemoveBtn:function(D,E){if(E.editNameFlag||i(E,q.id.REMOVE,D).length>0){return}if(!v.apply(D.edit.showRemoveBtn,[D.treeId,E],D.edit.showRemoveBtn)){return}var G=i(E,q.id.A,D),F="<span class='"+q.className.BUTTON+" remove' id='"+E.tId+q.id.REMOVE+"' title='"+v.apply(D.edit.removeTitle,[D.treeId,E],D.edit.removeTitle)+"' treeNode"+q.id.REMOVE+" style='display:none;'></span>";G.append(F);i(E,q.id.REMOVE,D).bind("click",function(){if(!v.uCanDo(D)||v.apply(D.callback.beforeRemove,[D.treeId,E],true)==false){return false}j.removeNode(D,E);D.treeObj.trigger(q.event.REMOVE,[D.treeId,E]);return false}).bind("mousedown",function(H){return true}).show()},addHoverDom:function(D,E){if(A.getRoots().showHoverDom){E.isHover=true;if(D.edit.enable){j.addEditBtn(D,E);j.addRemoveBtn(D,E)}v.apply(D.view.addHoverDom,[D.treeId,E])}},cancelCurEditNode:function(I,H,G){var E=A.getRoot(I),J=E.curEditNode;if(J){var F=E.curEditInput,D=H?H:(G?A.nodeName(I,J):F.val());if(v.apply(I.callback.beforeRename,[I.treeId,J,D,G],true)===false){return false}A.nodeName(I,J,D);var K=i(J,q.id.A,I);K.removeClass(q.node.CURSELECTED_EDIT);F.unbind();j.setNodeName(I,J);J.editNameFlag=false;E.curEditNode=null;E.curEditInput=null;j.selectNode(I,J,false);I.treeObj.trigger(q.event.RENAME,[I.treeId,J,G])}E.noSelection=true;return true},editNode:function(F,G){var D=A.getRoot(F);j.editNodeBlur=false;if(A.isSelectedNode(F,G)&&D.curEditNode==G&&G.editNameFlag){setTimeout(function(){v.inputFocus(D.curEditInput)},0);return}G.editNameFlag=true;j.removeTreeDom(F,G);j.cancelCurEditNode(F);j.selectNode(F,G,false);i(G,q.id.SPAN,F).html("<input type=text class='rename' id='"+G.tId+q.id.INPUT+"' treeNode"+q.id.INPUT+" >");var E=i(G,q.id.INPUT,F);E.attr("value",A.nodeName(F,G));if(F.edit.editNameSelectAll){v.inputSelect(E)}else{v.inputFocus(E)}E.bind("blur",function(H){if(!j.editNodeBlur){j.cancelCurEditNode(F)}}).bind("keydown",function(H){if(H.keyCode=="13"){j.editNodeBlur=true;j.cancelCurEditNode(F)}else{if(H.keyCode=="27"){j.cancelCurEditNode(F,null,true)}}}).bind("click",function(H){return false}).bind("dblclick",function(H){return false});i(G,q.id.A,F).addClass(q.node.CURSELECTED_EDIT);D.curEditInput=E;D.noSelection=false;D.curEditNode=G},moveNode:function(O,H,R,F,ad,I){var T=A.getRoot(O);if(H==R){return}if(O.data.keep.leaf&&H&&!A.nodeIsParent(O,H)&&F==q.move.TYPE_INNER){return}var W=(R.parentTId?R.getParentNode():T),Q=(H===null||H==T);if(Q&&H===null){H=T}if(Q){F=q.move.TYPE_INNER}var D=(H.parentTId?H.getParentNode():T);if(F!=q.move.TYPE_PREV&&F!=q.move.TYPE_NEXT){F=q.move.TYPE_INNER}if(F==q.move.TYPE_INNER){if(Q){R.parentTId=null}else{if(!A.nodeIsParent(O,H)){A.nodeIsParent(O,H,true);H.open=!!H.open;j.setNodeLineIcos(O,H)}R.parentTId=H.tId}}var J,L;if(Q){J=O.treeObj;L=J}else{if(!I&&F==q.move.TYPE_INNER){j.expandCollapseNode(O,H,true,false)}else{if(!I){j.expandCollapseNode(O,H.getParentNode(),true,false)}}J=i(H,O);L=i(H,q.id.UL,O);if(!!J.get(0)&&!L.get(0)){var ab=[];j.makeUlHtml(O,H,ab,"");J.append(ab.join(""))}L=i(H,q.id.UL,O)}var Z=i(R,O);if(!Z.get(0)){Z=j.appendNodes(O,R.level,[R],null,-1,false,true).join("")}else{if(!J.get(0)){Z.remove()}}if(L.get(0)&&F==q.move.TYPE_INNER){L.append(Z)}else{if(J.get(0)&&F==q.move.TYPE_PREV){J.before(Z)}else{if(J.get(0)&&F==q.move.TYPE_NEXT){J.after(Z)}}}var V,U,M=-1,Y=0,ac=null,E=null,aa=R.level;var X=A.nodeChildren(O,W);var K=A.nodeChildren(O,D);var G=A.nodeChildren(O,H);if(R.isFirstNode){M=0;if(X.length>1){ac=X[1];ac.isFirstNode=true}}else{if(R.isLastNode){M=X.length-1;ac=X[M-1];ac.isLastNode=true}else{for(V=0,U=X.length;V<U;V++){if(X[V].tId==R.tId){M=V;break}}}}if(M>=0){X.splice(M,1)}if(F!=q.move.TYPE_INNER){for(V=0,U=K.length;V<U;V++){if(K[V].tId==H.tId){Y=V}}}if(F==q.move.TYPE_INNER){if(!G){G=A.nodeChildren(O,H,[])}if(G.length>0){E=G[G.length-1];E.isLastNode=false}G.splice(G.length,0,R);R.isLastNode=true;R.isFirstNode=(G.length==1)}else{if(H.isFirstNode&&F==q.move.TYPE_PREV){K.splice(Y,0,R);E=H;E.isFirstNode=false;R.parentTId=H.parentTId;R.isFirstNode=true;R.isLastNode=false}else{if(H.isLastNode&&F==q.move.TYPE_NEXT){K.splice(Y+1,0,R);E=H;E.isLastNode=false;R.parentTId=H.parentTId;R.isFirstNode=false;R.isLastNode=true}else{if(F==q.move.TYPE_PREV){K.splice(Y,0,R)}else{K.splice(Y+1,0,R)}R.parentTId=H.parentTId;R.isFirstNode=false;R.isLastNode=false}}}A.fixPIdKeyValue(O,R);A.setSonNodeLevel(O,R.getParentNode(),R);j.setNodeLineIcos(O,R);j.repairNodeLevelClass(O,R,aa);if(!O.data.keep.parent&&X.length<1){A.nodeIsParent(O,W,false);W.open=false;var P=i(W,q.id.UL,O),S=i(W,q.id.SWITCH,O),N=i(W,q.id.ICON,O);j.replaceSwitchClass(W,S,q.folder.DOCU);j.replaceIcoClass(W,N,q.folder.DOCU);P.css("display","none")}else{if(ac){j.setNodeLineIcos(O,ac)}}if(E){j.setNodeLineIcos(O,E)}if(!!O.check&&O.check.enable&&j.repairChkClass){j.repairChkClass(O,W);j.repairParentChkClassWithSelf(O,W);if(W!=R.parent){j.repairParentChkClassWithSelf(O,R)}}if(!I){j.expandCollapseParentNode(O,R.getParentNode(),true,ad)}},removeEditBtn:function(D,E){i(E,q.id.EDIT,D).unbind().remove()},removeRemoveBtn:function(D,E){i(E,q.id.REMOVE,D).unbind().remove()},removeTreeDom:function(D,E){E.isHover=false;j.removeEditBtn(D,E);j.removeRemoveBtn(D,E);v.apply(D.view.removeHoverDom,[D.treeId,E])},repairNodeLevelClass:function(E,G,F){if(F===G.level){return}var H=i(G,E),K=i(G,q.id.A,E),J=i(G,q.id.UL,E),D=q.className.LEVEL+F,I=q.className.LEVEL+G.level;H.removeClass(D);H.addClass(I);K.removeClass(D);K.addClass(I);J.removeClass(D);J.addClass(I)},selectNodes:function(G,E){for(var F=0,D=E.length;F<D;F++){j.selectNode(G,E[F],F>0)}}},t={tools:h,view:d,event:g,data:p};f.extend(true,f.fn.zTree.consts,C);f.extend(true,f.fn.zTree._z,t);var b=f.fn.zTree,v=b._z.tools,q=b.consts,j=b._z.view,A=b._z.data,s=b._z.event,i=v.$;A.exSetting(m);A.addInitBind(n);A.addInitUnBind(z);A.addInitCache(c);A.addInitNode(w);A.addInitProxy(o);A.addInitRoot(x);A.addZTreeTools(k);var u=j.cancelPreSelectedNode;j.cancelPreSelectedNode=function(F,G){var H=A.getRoot(F).curSelectedList;for(var E=0,D=H.length;E<D;E++){if(!G||G===H[E]){j.removeTreeDom(F,H[E]);if(G){break}}}if(u){u.apply(j,arguments)}};var y=j.createNodes;j.createNodes=function(G,H,E,D,F){if(y){y.apply(j,arguments)}if(!E){return}if(j.repairParentChkClassWithSelf){j.repairParentChkClassWithSelf(G,D)}};var r=j.makeNodeUrl;j.makeNodeUrl=function(D,E){return D.edit.enable?null:(r.apply(j,arguments))};var a=j.removeNode;j.removeNode=function(E,F){var D=A.getRoot(E);if(D.curEditNode===F){D.curEditNode=null}if(a){a.apply(j,arguments)}};var B=j.selectNode;j.selectNode=function(F,G,E){var D=A.getRoot(F);if(A.isSelectedNode(F,G)&&D.curEditNode==G&&G.editNameFlag){return false}if(B){B.apply(j,arguments)}j.addHoverDom(F,G);return true};var e=v.uCanDo;v.uCanDo=function(E,F){var D=A.getRoot(E);if(F&&(v.eqs(F.type,"mouseover")||v.eqs(F.type,"mouseout")||v.eqs(F.type,"mousedown")||v.eqs(F.type,"mouseup"))){return true}if(D.curEditNode){j.editNodeBlur=false;D.curEditInput.focus()}return(!D.curEditNode)&&(e?e.apply(j,arguments):true)}})(jQuery);