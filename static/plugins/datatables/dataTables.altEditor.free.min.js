(function(factory){if(typeof define==="function"&&define.amd){define(["jquery","datatables.net"],function($){return factory($,window,document)})}else if(typeof exports==="object"){module.exports=function(root,$){if(!root){root=window}if(!$||!$.fn.dataTable){$=require("datatables.net")(root,$).$}return factory($,root,root.document)}}else{factory(jQuery,window,document)}})(function($,window,document,undefined){"use strict";var DataTable=$.fn.dataTable;var _instance=0;var altEditor=function(dt,opts){if(!DataTable.versionCheck||!DataTable.versionCheck("1.10.8")){throw"Warning: altEditor requires DataTables 1.10.8 or greater"}this.c=$.extend(true,{},DataTable.defaults.altEditor,altEditor.defaults,opts);this.s={dt:new DataTable.Api(dt),namespace:".altEditor"+_instance++};this.dom={modal:$('<div class="dt-altEditor-handle"/>')};this._constructor()};$.extend(altEditor.prototype,{_constructor:function(){var that=this;var dt=this.s.dt;if(dt.settings()[0].oInit.onAddRow)that.onAddRow=dt.settings()[0].oInit.onAddRow;if(dt.settings()[0].oInit.onDeleteRow)that.onDeleteRow=dt.settings()[0].oInit.onDeleteRow;if(dt.settings()[0].oInit.onEditRow)that.onEditRow=dt.settings()[0].oInit.onEditRow;that.closeModalOnSuccess=dt.settings()[0].oInit.closeModalOnSuccess;if(that.closeModalOnSuccess===undefined){that.closeModalOnSuccess=true}that.encodeFiles=dt.settings()[0].oInit.encodeFiles;if(that.encodeFiles===undefined){that.encodeFiles=true}this._setup();dt.on("destroy.altEditor",function(){dt.off(".altEditor");$(dt.table().body()).off(that.s.namespace);$(document.body).off(that.s.namespace)})},_setup:function(){var that=this;var dt=this.s.dt;this.random_id=(""+Math.random()).replace(".","");var modal_id="altEditor-modal-"+this.random_id;this.modal_selector="#"+modal_id;this.language=dt.settings()[0].oLanguage.altEditor||{};this.language.modalClose=this.language.modalClose||"取消";this.language.edit=this.language.edit||{};this.language.edit={title:this.language.edit.title||"修改数据",button:this.language.edit.button||"修改"};this.language.delete=this.language.delete||{};this.language.delete={title:this.language.delete.title||"删除数据",button:this.language.delete.button||"删除"};this.language.add=this.language.add||{};this.language.add={title:this.language.add.title||"添加数据",button:this.language.add.button||"添加"};this.language.success=this.language.success||"操作成功!";this.language.error=this.language.error||{};this.language.error={message:this.language.error.message||"发生未知错误!",label:this.language.error.label||"出错了!",responseCode:this.language.error.responseCode||"响应代码: ",required:this.language.error.required||"必填项",unique:this.language.error.unique||"有重复字段"};var modal='<div class="ax-window" data-mask="true" data-drag="true" id="'+modal_id+'">'+'<div class="ax-window-overlay"></div>'+'<div class="ax-window-contain">'+'<a href="###" class="ax-window-close"><i class="ax-iconfont ax-icon-close"></i></a>'+'<div class="ax-window-title"></div>'+'<div class="ax-break-line"></div>'+'<div class="ax-window-content ax-emulate">'+"</div>"+'<div class="ax-padding ax-window-operate">'+'<div class="ax-row">'+'<div class="ax-col">'+"</div>"+'<div class="ax-btns">'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>";$("body").append(modal);if(dt.button("edit:name")){dt.button("edit:name").action(function(e,dt,node,config){that._openEditModal();$("#altEditor-edit-form-"+that.random_id).off("submit").on("submit",function(e){e.preventDefault();e.stopPropagation();that._editRowData()})})}if(dt.button("delete:name")){dt.button("delete:name").action(function(e,dt,node,config){that._openDeleteModal();$("#altEditor-delete-form-"+that.random_id).off("submit").on("submit",function(e){e.preventDefault();e.stopPropagation();that._deleteRow()})})}if(dt.button("add:name")){dt.button("add:name").action(function(e,dt,node,config){that._openAddModal();$("#altEditor-add-form-"+that.random_id).off("submit").on("submit",function(e){e.preventDefault();e.stopPropagation();that._addRowData()})})}$(this.modal_selector).bind("input","[data-unique]",function(elm){if($(elm.target).attr("data-unique")==null||$(elm.target).attr("data-unique")==="false"){return}var target=$(elm.target);var colData=dt.column("th:contains('"+target.attr("name")+"')").data();var selectedCellData=null;if(dt.row({selected:true}).index()!=null)selectedCellData=dt.cell(dt.row({selected:true}).index(),dt.column("th:contains('"+target.attr("name")+"')").index()).data();elm.target.setCustomValidity("");for(var j in colData){if(target.val()==colData[j]&&colData[j]!=selectedCellData){elm.target.setCustomValidity(that.language.error.unique)}}});if(this.s.dt.button("refresh:name")){this.s.dt.button("refresh:name").action(function(e,dt,node,config){if(dt.ajax&&dt.ajax.url()){dt.ajax.reload()}})}},_emitEvent:function(name,args){this.s.dt.iterator("table",function(ctx,i){$(ctx.nTable).triggerHandler(name+".dt",args)})},_openEditModal:function(){var dt=this.s.dt;var adata=dt.rows({selected:true});var columnDefs=this.completeColumnDefs();var data=this.createDialog(columnDefs,this.language.edit.title,this.language.edit.button,this.language.modalClose,"editRowBtn","altEditor-edit-form");var selector=this.modal_selector;for(var j in columnDefs){if(columnDefs[j].name!=null){var arrIndex=columnDefs[j].name.toString().split(".");var selectedValue=adata.data()[0];for(var index=0;index<arrIndex.length;index++){if(selectedValue)selectedValue=selectedValue[arrIndex[index]]}var jquerySelector="#"+columnDefs[j].name.toString().replace(/\./g,"\\.");$(selector).find(jquerySelector).val(selectedValue!=null?selectedValue.toString().trim():null);$(selector).find(jquerySelector).trigger("change");if(columnDefs[j].type.indexOf("checkbox")>=0){if(this._quoteattr(selectedValue)==="true"||this._quoteattr(selectedValue)=="1"){$(selector).find(jquerySelector).prop("checked",this._quoteattr(selectedValue))}}if(columnDefs[j].type.indexOf("date")>=0){if(columnDefs[j].dateFormat!==""){var mDate=moment(this._quoteattr(selectedValue));if(mDate&&mDate.isValid()){$(selector).find(jquerySelector).val(mDate.format(columnDefs[j].dateFormat))}}}}}$(selector+" input[0]").trigger("focus");$(selector).trigger("alteditor:some_dialog_opened").trigger("alteditor:edit_dialog_opened")},_editRowData:function(){var that=this;var dt=this.s.dt;var rowDataArray={};var adata=dt.rows({selected:true});var orginalRowDataArray=adata.data()[0];$('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type!="file"]').filter(":enabled").each(function(i){rowDataArray[$(this).attr("id")]=$(this).val()});$('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter("textarea").each(function(i){rowDataArray[$(this).attr("id")]=$(this).val()});var numFilesQueued=0;$('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type="file"]').each(function(i){if($(this).prop("files")[0]){if(that.encodeFiles){++numFilesQueued;that.getBase64($(this).prop("files")[0],function(filecontent){rowDataArray[$(this).attr("id")]=filecontent;--numFilesQueued})}else{rowDataArray[$(this).attr("id")]=$(this).prop("files")[0]}}});$('form[name="altEditor-edit-form-'+this.random_id+'"] *').filter(':input[type="checkbox"]').each(function(i){rowDataArray[$(this).attr("id")]=this.checked});console.log(rowDataArray);var checkFilesQueued=function(){if(numFilesQueued==0){that.onEditRow(that,rowDataArray,function(data,b,c,d,e){that._editRowCallback(data,b,c,d,e)},function(data){that._errorCallback(data)},orginalRowDataArray)}else{console.log("Waiting for file base64-decoding...");setTimeout(checkFilesQueued,1e3)}};checkFilesQueued()},_openDeleteModal:function(){var that=this;var dt=this.s.dt;var adata=dt.rows({selected:true});var columnDefs=this.completeColumnDefs();var formName="altEditor-delete-form-"+this.random_id;var data="";for(var j in columnDefs){if(columnDefs[j].name==null)continue;if(columnDefs[j].type.indexOf("hidden")>=0){data+="<input type='hidden' id='"+columnDefs[j].title+"' value='"+adata.data()[0][columnDefs[j].name]+"'></input>"}else if(columnDefs[j].type.indexOf("file")<0){var arrIndex=columnDefs[j].name.toString().split(".");var fvalue=adata.data()[0];for(var index=0;index<arrIndex.length;index++){if(fvalue)fvalue=fvalue[arrIndex[index]]}if(columnDefs[j].type.indexOf("date")>=0){if(columnDefs[j].dateFormat!==""){var mDate=moment(adata.data()[0][columnDefs[j].name]);if(mDate&&mDate.isValid()){fvalue=mDate.format(columnDefs[j].dateFormat)}}}if(columnDefs[j].type.indexOf("select")>=0){var options=columnDefs[j].options;var mapper=function(x){if(options.length===undefined){return x in options?options[x]:null}else{return x}};if(fvalue instanceof Array){var mapped=fvalue.map(mapper).filter(function(x){return x!=null});fvalue=mapped.join(", ")}else{fvalue=mapper(fvalue)}}data+="<div class='ax-form-group'><div class='ax-flex-row'><div class='ax-form-label' for='"+that._quoteattr(columnDefs[j].name)+"'>"+columnDefs[j].title+"：</div><div class='ax-form-input'><input  type='hidden'  id='"+that._quoteattr(columnDefs[j].title)+"' name='"+that._quoteattr(columnDefs[j].title)+"' placeholder='"+that._quoteattr(columnDefs[j].title)+"' style='overflow:hidden'  class='form-control' value='"+that._quoteattr(fvalue)+"' >"+fvalue+"</input></div></div></div></div><div class='ax-break-line'></div>"}}var selector=this.modal_selector;var btns='<a href="###" class="ax-btn ax-text ax-ignore ax-window-close">'+that.language.modalClose+"</a>"+'<button type="submit" class="ax-btn ax-primary" id="deleteRowBtn">'+that.language.delete.button+"</button>";$(selector).find(".ax-window-title").html(that.language.delete.title);$(selector).find(".ax-window-content").html(data);$(selector).find(".ax-btns").html(btns);var modalContent=$(selector).find(".ax-window-contain");if(modalContent.parent().is("form")){modalContent.parent().attr("name",formName);modalContent.parent().attr("id",formName)}else{modalContent.wrap("<form name='"+formName+"' id='"+formName+"' role='form'></form>")}$(selector).addClass("ax-window-show");$(selector+"[data-drag='true'] .ax-window-title").mousedown(function(e){$(this).css("cursor","move");var moveDIV=$(this).parent();$(this).parent().css({position:"fixed",transition:"none"});var offset=moveDIV.offset();var x=e.clientX-offset.left;var y=e.clientY-offset.top;$(document).bind("mousemove",function(ev){var _x=ev.clientX-x;var _y=ev.clientY-y-$(window).scrollTop();moveDIV.css({left:_x+"px",top:_y+"px"})})});$(document).mouseup(function(){$(this).unbind("mousemove")});$(selector+" input[0]").trigger("focus");$(selector).trigger("alteditor:some_dialog_opened").trigger("alteditor:delete_dialog_opened")},_deleteRow:function(){var that=this;var dt=this.s.dt;var jsonDataArray={};var adata=dt.rows({selected:true});for(var i=0;i<dt.context[0].aoColumns.length;i++){var name=dt.context[0].aoColumns[i].data?dt.context[0].aoColumns[i].data:dt.context[0].aoColumns[i].mData?dt.context[0].aoColumns[i].mData:dt.context[0].aoColumns[i].idx;jsonDataArray[name]=adata.data()[0][name]}that.onDeleteRow(that,jsonDataArray,function(data){that._deleteRowCallback(data)},function(data){that._errorCallback(data)})},_openAddModal:function(){var dt=this.s.dt;var columnDefs=this.completeColumnDefs();var data=this.createDialog(columnDefs,this.language.add.title,this.language.add.button,this.language.modalClose,"addRowBtn","altEditor-add-form");var selector=this.modal_selector;$(selector+" input[0]").trigger("focus");$(selector).trigger("alteditor:some_dialog_opened").trigger("alteditor:add_dialog_opened")},completeColumnDefs:function(){var columnDefs=[];var dt=this.s.dt;for(var i in dt.context[0].aoColumns){var obj=dt.context[0].aoColumns[i];columnDefs[i]={title:obj.sTitle,placeholder:obj.placeholder?obj.placeholder:obj.title,name:obj.data?obj.data:obj.mData,type:obj.type?obj.type:"text",rows:obj.rows?obj.rows:"5",cols:obj.cols?obj.cols:"30",options:obj.options?obj.options:[],readonly:obj.readonly?obj.readonly:false,disabled:obj.disabled?obj.disabled:false,required:obj.required?obj.required:false,msg:obj.errorMsg?obj.errorMsg:"",hoverMsg:obj.hoverMsg?obj.hoverMsg:"",pattern:obj.pattern?obj.pattern:".*",special:obj.special?obj.special:"",unique:obj.unique?obj.unique:false,uniqueMsg:obj.uniqueMsg?obj.uniqueMsg:"",maxLength:obj.maxLength?obj.maxLength:false,multiple:obj.multiple?obj.multiple:false,select2:obj.select2?obj.select2:false,datepicker:obj.datepicker?obj.datepicker:false,datetimepicker:obj.datetimepicker?obj.datetimepicker:false,editorOnChange:obj.editorOnChange?obj.editorOnChange:null,style:obj.style?obj.style:"",dateFormat:obj.dateFormat?obj.dateFormat:"",optionsSortByLabel:obj.optionsSortByLabel?obj.optionsSortByLabel:false,inline:obj.inline?obj.inline:false,step:obj.step?obj.step:null,min:obj.min?obj.min:null,max:obj.max?obj.max:null,value:obj.value?obj.value:""}}return columnDefs},createDialog:function(columnDefs,title,buttonCaption,closeCaption,buttonClass,formName){formName=[formName,this.random_id].join("-");var data="",count=0;for(var j in columnDefs){if(columnDefs[j].type.indexOf("hidden")>=0){data+="<input type='hidden' id='"+columnDefs[j].name+"' ></input>"}else{if(columnDefs[j].inline){if(count==0){count++;data+="<div class='ax-form-group' id='alteditor-row-"+this._quoteattr(columnDefs[j].name)+"'><div class='ax-flex-row'>";data+="<div for='"+columnDefs[j].name+"'  class='ax-form-label'>"+columnDefs[j].title+":</div></div>";data+="<div class='col-sm-2 col-md-2 col-lg-2'>"}else data+="<div class='col-sm-2 col-md-2 col-lg-2'>"}else{data+="<div class='ax-form-group' id='alteditor-row-"+this._quoteattr(columnDefs[j].name)+"'><div class='ax-flex-row'>";data+="<div for='"+columnDefs[j].name+"' class='ax-form-label'>"+columnDefs[j].title+":</div>";data+="<div class='ax-form-input'>"}if(columnDefs[j].type.indexOf("readonly")>=0){data+="<input type='text' readonly  id='"+this._quoteattr(columnDefs[j].name)+"' name='"+this._quoteattr(columnDefs[j].title)+"' placeholder='"+this._quoteattr(columnDefs[j].placeholder?columnDefs[j].placeholder:columnDefs[j].title)+"' style='overflow:hidden'  class='form-control  form-control-sm' value=''>"}else if(columnDefs[j].type.indexOf("select")>=0){var options="";var optionsArray=columnDefs[j].options;if(optionsArray.length>0){for(var i=0;i<optionsArray.length;i++){options+="<option value='"+this._quoteattr(optionsArray[i])+"'>"+optionsArray[i]+"</option>"}}else{for(var x in optionsArray){options+="<option value='"+this._quoteattr(x)+"' >"+optionsArray[x]+"</option>"}}data+="<select class='form-control"+(columnDefs[j].select2?" select2":"")+"' id='"+this._quoteattr(columnDefs[j].name)+"' name='"+this._quoteattr(columnDefs[j].title)+"' placeholder='"+this._quoteattr(columnDefs[j].placeholder?columnDefs[j].placeholder:columnDefs[j].title)+"' data-special='"+this._quoteattr(columnDefs[j].special)+"' data-errorMsg='"+this._quoteattr(columnDefs[j].msg)+"' data-uniqueMsg='"+this._quoteattr(columnDefs[j].uniqueMsg)+"' data-unique='"+columnDefs[j].unique+"' "+(columnDefs[j].readonly?" readonly ":"")+(columnDefs[j].disabled?" disabled ":"")+(columnDefs[j].required?" required ":"")+(columnDefs[j].multiple?" multiple ":"")+">"+options+"</select>"}else if(columnDefs[j].type.indexOf("textarea")>=0){data+="<textarea class='form-control' id='"+this._quoteattr(columnDefs[j].name)+"' name='"+this._quoteattr(columnDefs[j].title)+"' rows='"+this._quoteattr(columnDefs[j].rows)+"' cols='"+this._quoteattr(columnDefs[j].cols)+"' placeholder='"+this._quoteattr(columnDefs[j].placeholder?columnDefs[j].placeholder:columnDefs[j].title)+"' data-special='"+this._quoteattr(columnDefs[j].special)+"' data-errorMsg='"+this._quoteattr(columnDefs[j].msg)+"' data-uniqueMsg='"+this._quoteattr(columnDefs[j].uniqueMsg)+"' data-unique='"+columnDefs[j].unique+"' "+(columnDefs[j].readonly?" readonly ":"")+(columnDefs[j].disabled?" disabled ":"")+(columnDefs[j].required?" required ":"")+(columnDefs[j].maxLength==false?"":" maxlength='"+columnDefs[j].maxLength+"'")+" style='"+this._quoteattr(columnDefs[j].style)+"'>"+"</textarea>"}else{data+="<input class='form-control' type='"+this._quoteattr(columnDefs[j].type)+"' id='"+this._quoteattr(columnDefs[j].name)+"' pattern='"+this._quoteattr(columnDefs[j].pattern)+"' title='"+this._quoteattr(columnDefs[j].hoverMsg)+"' name='"+this._quoteattr(columnDefs[j].title)+"' step='"+this._quoteattr(columnDefs[j].step)+"' min='"+this._quoteattr(columnDefs[j].min)+"' max='"+this._quoteattr(columnDefs[j].max)+"' value='"+this._quoteattr(columnDefs[j].value)+"' placeholder='"+this._quoteattr(columnDefs[j].placeholder?columnDefs[j].placeholder:columnDefs[j].title)+"' data-special='"+this._quoteattr(columnDefs[j].special)+"' data-errorMsg='"+this._quoteattr(columnDefs[j].msg)+"' data-uniqueMsg='"+this._quoteattr(columnDefs[j].uniqueMsg)+"' data-unique='"+columnDefs[j].unique+"' "+(columnDefs[j].readonly?" readonly ":"")+(columnDefs[j].disabled?" disabled ":"")+(columnDefs[j].required?" required ":"")+(columnDefs[j].maxLength==false?"":" maxlength='"+columnDefs[j].maxLength+"'")+" style='overflow:hidden;"+this._quoteattr(columnDefs[j].style)+"' class='form-control  form-control-sm' value=''>"}data+="</div>";data+="<div id='"+this._quoteattr(columnDefs[j].name)+"label"+"' class='ax-valid'></div>";if(!columnDefs[j].inline||+j+1<columnDefs.length&&!columnDefs[+j+1].inline){data+="</div></div><div class='ax-break-line'></div>"}else data+="</div></div><div class='ax-break-line'></div>"}}var selector=this.modal_selector;var btns='<a href="###" class="ax-btn ax-text ax-ignore ax-window-close">'+closeCaption+"</a>"+'<button type="submit" class="ax-btn ax-primary" id="'+buttonClass+'">'+buttonCaption+"</button>";$(selector).find(".ax-window-title").html(title);$(selector).find(".ax-window-content").html(data);$(selector).find(".ax-btns").html(btns);var modalContent=$(selector).find(".ax-window-contain");if(modalContent.parent().is("form")){modalContent.parent().attr("name",formName);modalContent.parent().attr("id",formName)}else{modalContent.wrap("<form name='"+formName+"' id='"+formName+"' role='form'></form>")}$(selector).addClass("ax-window-show");$(selector+"[data-drag='true'] .ax-window-title").mousedown(function(e){$(this).css("cursor","move");var moveDIV=$(this).parent();$(this).parent().css({position:"fixed",transition:"none"});var offset=moveDIV.offset();var x=e.clientX-offset.left;var y=e.clientY-offset.top;$(document).bind("mousemove",function(ev){var _x=ev.clientX-x;var _y=ev.clientY-y-$(window).scrollTop();moveDIV.css({left:_x+"px",top:_y+"px"})})});$(document).mouseup(function(){$(this).unbind("mousemove")});$(selector+" input[0]").trigger("focus");var win=$(selector),contain=win.find(".ax-window-contain"),content=win.find(".ax-window-content"),overlay=win.find(".ax-window-overlay"),close=win.find(".ax-window-close");overlay.click(function(){overlay.css({opacity:"0"});setTimeout(function(){win.removeClass("ax-window-show");overlay.removeAttr("style");contain.removeAttr("style");content.getAxScroll().hide()},300);setTimeout(function(){content.getAxScroll().hide()},300);contain.css({"animation-duration":".2s","animation-name":"scaleOut"})});close.click(function(){overlay.css({opacity:"0"});setTimeout(function(){win.removeClass("ax-window-show");overlay.removeAttr("style");contain.removeAttr("style")},300);setTimeout(function(){content.getAxScroll().hide()},300);contain.css({"animation-duration":".2s","animation-name":"scaleOut"})});var that=this;for(var j in columnDefs){if(columnDefs[j].select2){$(selector).find("select#"+columnDefs[j].name).select2(columnDefs[j].select2)}else if(columnDefs[j].datepicker){$(selector).find("#"+columnDefs[j].name).datepicker(columnDefs[j].datepicker)}else if(columnDefs[j].datetimepicker){$(selector).find("#"+columnDefs[j].name).datetimepicker(columnDefs[j].datetimepicker)}if(columnDefs[j].editorOnChange){$(selector).find("#"+$.escapeSelector(columnDefs[j].name)).attr("alt-editor-id",this._quoteattr(j));$(selector).find("#"+$.escapeSelector(columnDefs[j].name)).on("change",function(elm){var f=columnDefs[$(this).attr("alt-editor-id")].editorOnChange;f(elm,that)})}if(columnDefs[j].type.indexOf("select")>=0){if(columnDefs[j].optionsSortByLabel){var jquerySelector="#"+columnDefs[j].name.toString().replace(/\./g,"\\.");var opts_list=$(selector).find(jquerySelector).find("option");opts_list.sort(function(a,b){return $(a).text()>$(b).text()?1:-1});$(selector).find(jquerySelector).html("").append(opts_list);$(selector).find(jquerySelector).val($(jquerySelector+" option:first").val())}}}},_addRowData:function(){var that=this;var dt=this.s.dt;var rowDataArray={};$('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type!="file"]').filter(":enabled").each(function(i){rowDataArray[$(this).attr("id")]=$(this).val()});$('form[name="altEditor-add-form-'+this.random_id+'"] *').filter("textarea").each(function(i){rowDataArray[$(this).attr("id")]=$(this).val()});var numFilesQueued=0;$('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type="file"]').each(function(i){if($(this).prop("files")[0]){if(that.encodeFiles){++numFilesQueued;that.getBase64($(this).prop("files")[0],function(filecontent){rowDataArray[$(this).attr("id")]=filecontent;--numFilesQueued})}else{rowDataArray[$(this).attr("id")]=$(this).prop("files")[0]}}});$('form[name="altEditor-add-form-'+this.random_id+'"] *').filter(':input[type="checkbox"]').each(function(i){rowDataArray[$(this).attr("id")]=this.checked});console.log(rowDataArray);var checkFilesQueued=function(){if(numFilesQueued==0){that.onAddRow(that,rowDataArray,function(data){that._addRowCallback(data)},function(data){that._errorCallback(data)})}else{console.log("Waiting for file base64-decoding...");setTimeout(checkFilesQueued,1e3)}};checkFilesQueued()},_deleteRowCallback:function(response,status,more){var selector=this.modal_selector;$(selector+" .ax-window-content .alert").remove();if(this.closeModalOnSuccess){this.internalCloseDialog(selector)}else{var message='<div class="alert alert-success" role="alert">'+"<strong>"+this.language.success+"</strong>"+"</div>";$(selector+" .ax-window-content").append(message)}this.s.dt.row({selected:true}).remove();this.s.dt.draw("page");$("div"+selector).find("button#addRowBtn").prop("disabled",true);$("div"+selector).find("button#editRowBtn").prop("disabled",true);$("div"+selector).find("button#deleteRowBtn").prop("disabled",true)},_addRowCallback:function(response,status,more){var data=typeof response==="string"?JSON.parse(response):response;var selector=this.modal_selector;$(selector+" .ax-window-content .alert").remove();if(this.closeModalOnSuccess){this.internalCloseDialog(selector)}else{var message='<div class="alert alert-success" role="alert">'+"<strong>"+this.language.success+"</strong>"+"</div>";$(selector+" .ax-window-content").append(message)}this.s.dt.row.add(data).draw(false);$("div"+selector).find("button#addRowBtn").prop("disabled",true);$("div"+selector).find("button#editRowBtn").prop("disabled",true);$("div"+selector).find("button#deleteRowBtn").prop("disabled",true)},_editRowCallback:function(response,status,more){var data=typeof response==="string"?JSON.parse(response):response;var selector=this.modal_selector;$(selector+" .ax-window-content .alert").remove();if(this.closeModalOnSuccess){this.internalCloseDialog(selector)}else{var message='<div class="alert alert-success" role="alert">'+"<strong>"+this.language.success+"</strong>"+"</div>";$(selector+" .ax-window-content").append(message)}this.s.dt.row({selected:true}).data(data);this.s.dt.draw("page");$("div"+selector).find("button#addRowBtn").prop("disabled",true);$("div"+selector).find("button#editRowBtn").prop("disabled",true);$("div"+selector).find("button#deleteRowBtn").prop("disabled",true)},_errorCallback:function(response,status,more){var error=response;var selector=this.modal_selector;$(selector+" .ax-window-content .alert").remove();var errstr=this.language.error.message;if(error.responseJSON&&error.responseJSON.errors){errstr="";for(var key in error.responseJSON.errors){errstr+=error.responseJSON.errors[key][0]}}var message='<div class="alert alert-danger" role="alert">'+"<strong>"+this.language.error.label+"</strong> "+(error.status==null?"":this.language.error.responseCode+error.status)+" "+errstr+"</div>";$(selector+" .ax-window-content").append(message)},onAddRow:function(dt,rowdata,success,error){console.log("Missing AJAX configuration for INSERT");success(rowdata)},onEditRow:function(dt,rowdata,success,error){console.log("Missing AJAX configuration for UPDATE");success(rowdata)},onDeleteRow:function(dt,rowdata,success,error){console.log("Missing AJAX configuration for DELETE");success(rowdata)},internalOpenDialog:function(selector,onopen){var win=$(selector),contain=win.find(".ax-window-contain"),content=win.find(".ax-window-content"),overlay=win.find(".ax-window-overlay"),close=win.find(".ax-window-close");overlay.css({opacity:"0"});setTimeout(function(){win.removeClass("ax-window-show");overlay.removeAttr("style");contain.removeAttr("style");content.getAxScroll().hide()},300);setTimeout(function(){content.getAxScroll().hide()},300);contain.css({"animation-duration":".2s","animation-name":"scaleOut"})},internalCloseDialog:function(selector){var win=$(selector),contain=win.find(".ax-window-contain"),content=win.find(".ax-window-content"),overlay=win.find(".ax-window-overlay"),close=win.find(".ax-window-close");overlay.css({opacity:"0"});setTimeout(function(){win.removeClass("ax-window-show");overlay.removeAttr("style");contain.removeAttr("style");content.getAxScroll().hide()},300);setTimeout(function(){content.getAxScroll().hide()},300);contain.css({"animation-duration":".2s","animation-name":"scaleOut"})},reloadOptions:function($select,options){var oldValue=$select.val();$select.empty();if(options.length>0){$.each(options,function(key,value){$select.append($("<option></option>").attr("value",value).text(value))})}else{$.each(options,function(key,value){$select.append($("<option></option>").attr("value",value).text(key))})}$select.val(oldValue);$select.trigger("change")},getBase64:function(file,onSuccess,onError){var reader=new FileReader;reader.readAsDataURL(file);reader.onload=function(){console.log(reader.result);if(onSuccess)onSuccess(reader.result)};reader.onerror=function(error){console.log("Error: ",error);if(onError)onError(error)}},_quoteattr:function(s,preserveCR){if(s==null)return"";preserveCR=preserveCR?"&#13;":"\n";if(Array.isArray(s)){var newArray=[];var x;for(x in s)newArray.push(s[x]);return newArray}return(""+s).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,preserveCR).replace(/[\r\n]/g,preserveCR)}});altEditor.version="2.0";altEditor.defaults={alwaysAsk:false,focus:null,columns:"",update:null,editor:null};altEditor.classes={btn:"btn"};$(document).on("preInit.dt.altEditor",function(e,settings,json){if(e.namespace!=="dt"){return}var init=settings.oInit.altEditor;var defaults=DataTable.defaults.altEditor;if(init||defaults){var opts=$.extend({},init,defaults);if(init!==false){var editor=new altEditor(settings,opts);e.target.altEditor=editor}}});DataTable.altEditor=altEditor;return altEditor});