(function(){"use strict";var $=typeof jQuery===typeof undefined?null:jQuery;var register=function(cytoscape,$){if(!cytoscape){return}var defaults={evtType:"cxttap",menuItems:[],menuItemClasses:[],contextMenuClasses:[]};var eventCyTapStart;cytoscape("core","contextMenus",function(opts){var cy=this;if(!cy.scratch("cycontextmenus")){cy.scratch("cycontextmenus",{})}var options=getScratchProp("options");var $cxtMenu=getScratchProp("cxtMenu");var menuItemCSSClass="cy-context-menus-cxt-menuitem";var dividerCSSClass="cy-context-menus-divider";function extend(defaults,options){var obj={};for(var i in defaults){obj[i]=defaults[i]}for(var i in options){obj[i]=options[i]}return obj}function getScratchProp(propname){return cy.scratch("cycontextmenus")[propname]}function setScratchProp(propname,value){cy.scratch("cycontextmenus")[propname]=value}function preventDefaultContextTap(){$(".cy-context-menus-cxt-menu").contextmenu(function(){return false})}function getMenuItemClassStr(classes,hasTrailingDivider){var str=getClassStr(classes);str+=" "+menuItemCSSClass;if(hasTrailingDivider){str+=" "+dividerCSSClass}return str}function getClassStr(classes){var str="";for(var i=0;i<classes.length;i++){var className=classes[i];str+=className;if(i!==classes.length-1){str+=" "}}return str}function displayComponent($component){$component.css("display","block")}function hideComponent($component){$component.css("display","none")}function hideMenuItemComponents(){$cxtMenu.children().css("display","none")}function bindOnClickFunction($component,onClickFcn){var callOnClickFcn;$component.on("click",callOnClickFcn=function(){onClickFcn(getScratchProp("currentCyEvent"))});$component.data("call-on-click-function",callOnClickFcn)}function bindCyCxttap($component,selector,coreAsWell){function _cxtfcn(event){setScratchProp("currentCyEvent",event);adjustCxtMenu(event);if($component.data("show")){if(!$cxtMenu.is(":visible")){displayComponent($cxtMenu)}setScratchProp("anyVisibleChild",true);displayComponent($component)}if(!getScratchProp("anyVisibleChild")&&$cxtMenu.is(":visible")){hideComponent($cxtMenu)}}var cxtfcn;var cxtCoreFcn;if(coreAsWell){cy.on(options.evtType,cxtCoreFcn=function(event){var target=event.target||event.cyTarget;if(target!=cy){return}_cxtfcn(event)})}if(selector){cy.on(options.evtType,selector,cxtfcn=function(event){_cxtfcn(event)})}$component.data("cy-context-menus-cxtfcn",cxtfcn);$component.data("cy-context-menus-cxtcorefcn",cxtCoreFcn)}function bindCyEvents(){cy.on("tapstart",eventCyTapStart=function(){hideComponent($cxtMenu);setScratchProp("cxtMenuPosition",undefined);setScratchProp("currentCyEvent",undefined)})}function performBindings($component,onClickFcn,selector,coreAsWell){bindOnClickFunction($component,onClickFcn);bindCyCxttap($component,selector,coreAsWell)}function adjustCxtMenu(event){var currentCxtMenuPosition=getScratchProp("cxtMenuPosition");var cyPos=event.position||event.cyPosition;if(currentCxtMenuPosition!=cyPos){hideMenuItemComponents();setScratchProp("anyVisibleChild",false);setScratchProp("cxtMenuPosition",cyPos);var containerPos=$(cy.container()).offset();var renderedPos=event.renderedPosition||event.cyRenderedPosition;var borderThickness=parseInt($(cy.container()).css("border-width").replace("px",""));if(borderThickness>0){containerPos.top+=borderThickness;containerPos.left+=borderThickness}var containerHeight=$(cy.container()).innerHeight();var containerWidth=$(cy.container()).innerWidth();var horizontalSplit=containerHeight/2;var verticalSplit=containerWidth/2;var windowHeight=$(window).height();var windowWidth=$(window).width();if(renderedPos.y>horizontalSplit&&renderedPos.x<=verticalSplit){$cxtMenu.css("left",renderedPos.x+containerPos.left);$cxtMenu.css("bottom",windowHeight-(containerPos.top+renderedPos.y));$cxtMenu.css("right","auto");$cxtMenu.css("top","auto")}else if(renderedPos.y>horizontalSplit&&renderedPos.x>verticalSplit){$cxtMenu.css("right",windowWidth-(containerPos.left+renderedPos.x));$cxtMenu.css("bottom",windowHeight-(containerPos.top+renderedPos.y));$cxtMenu.css("left","auto");$cxtMenu.css("top","auto")}else if(renderedPos.y<=horizontalSplit&&renderedPos.x<=verticalSplit){$cxtMenu.css("left",renderedPos.x+containerPos.left);$cxtMenu.css("top",renderedPos.y+containerPos.top);$cxtMenu.css("right","auto");$cxtMenu.css("bottom","auto")}else{$cxtMenu.css("right",windowWidth-(renderedPos.x+containerPos.left));$cxtMenu.css("top",renderedPos.y+containerPos.top);$cxtMenu.css("left","auto");$cxtMenu.css("bottom","auto")}}}function createAndAppendMenuItemComponents(menuItems){for(var i=0;i<menuItems.length;i++){createAndAppendMenuItemComponent(menuItems[i])}}function createAndAppendMenuItemComponent(menuItem){var $menuItemComponent=createMenuItemComponent(menuItem);appendComponentToCxtMenu($menuItemComponent);performBindings($menuItemComponent,menuItem.onClickFunction,menuItem.selector,menuItem.coreAsWell)}function createAndInsertMenuItemComponentBeforeExistingComponent(menuItem,existingComponentID){var $menuItemComponent=createMenuItemComponent(menuItem);insertComponentBeforeExistingItem($menuItemComponent,existingComponentID);performBindings($menuItemComponent,menuItem.onClickFunction,menuItem.selector,menuItem.coreAsWell)}function createAndAppendCxtMenuComponent(){var classes=getClassStr(options.contextMenuClasses);$cxtMenu=$("<div class="+classes+"></div>");$cxtMenu.addClass("cy-context-menus-cxt-menu");setScratchProp("cxtMenu",$cxtMenu);$("body").append($cxtMenu);return $cxtMenu}function createMenuItemComponent(item){var classStr=getMenuItemClassStr(options.menuItemClasses,item.hasTrailingDivider);var itemStr='<button id="'+item.id+'" class="'+classStr+'"';if(item.tooltipText){itemStr+=' title="'+item.tooltipText+'"'}if(item.disabled){itemStr+=" disabled"}if(!item.image){itemStr+=">"+item.content+"</button>"}else{itemStr+=">"+'<img src="'+item.image.src+'" width="'+item.image.width+'px"; height="'+item.image.height+'px"; style="position:absolute; top: '+item.image.y+"px; left: "+item.image.x+'px;">'+item.content+"</button>"}var $menuItemComponent=$(itemStr);$menuItemComponent.data("selector",item.selector);$menuItemComponent.data("on-click-function",item.onClickFunction);$menuItemComponent.data("show",typeof item.show==="undefined"||item.show);return $menuItemComponent}function appendComponentToCxtMenu(component){$cxtMenu.append(component);bindMenuItemClickFunction(component)}function insertComponentBeforeExistingItem(component,existingItemID){var $existingItem=$("#"+existingItemID);component.insertBefore($existingItem)}function destroyCxtMenu(){if(!getScratchProp("active")){return}removeAndUnbindMenuItems();cy.off("tapstart",eventCyTapStart);$cxtMenu.remove();$cxtMenu=undefined;setScratchProp($cxtMenu,undefined);setScratchProp("active",false);setScratchProp("anyVisibleChild",false)}function removeAndUnbindMenuItems(){var children=$cxtMenu.children();$(children).each(function(){removeAndUnbindMenuItem($(this))})}function removeAndUnbindMenuItem(itemID){var $component=typeof itemID==="string"?$("#"+itemID):itemID;var cxtfcn=$component.data("cy-context-menus-cxtfcn");var selector=$component.data("selector");var callOnClickFcn=$component.data("call-on-click-function");var cxtCoreFcn=$component.data("cy-context-menus-cxtcorefcn");if(cxtfcn){cy.off(options.evtType,selector,cxtfcn)}if(cxtCoreFcn){cy.off(options.evtType,cxtCoreFcn)}if(callOnClickFcn){$component.off("click",callOnClickFcn)}$component.remove()}function moveBeforeOtherMenuItemComponent(componentID,existingComponentID){if(componentID===existingComponentID){return}var $component=$("#"+componentID).detach();var $existingComponent=$("#"+existingComponentID);$component.insertBefore($existingComponent)}function bindMenuItemClickFunction(component){component.click(function(){hideComponent($cxtMenu);setScratchProp("cxtMenuPosition",undefined)})}function disableComponent(componentID){$("#"+componentID).attr("disabled",true)}function enableComponent(componentID){$("#"+componentID).attr("disabled",false)}function setTrailingDivider(componentID,status){var $component=$("#"+componentID);if(status){$component.addClass(dividerCSSClass)}else{$component.removeClass(dividerCSSClass)}}function getInstance(cy){var instance={isActive:function(){return getScratchProp("active")},appendMenuItem:function(item){createAndAppendMenuItemComponent(item);return cy},appendMenuItems:function(items){createAndAppendMenuItemComponents(items);return cy},removeMenuItem:function(itemID){removeAndUnbindMenuItem(itemID);return cy},setTrailingDivider:function(itemID,status){setTrailingDivider(itemID,status);return cy},insertBeforeMenuItem:function(item,existingItemID){createAndInsertMenuItemComponentBeforeExistingComponent(item,existingItemID);return cy},moveBeforeOtherMenuItem:function(itemID,existingItemID){moveBeforeOtherMenuItemComponent(itemID,existingItemID);return cy},disableMenuItem:function(itemID){disableComponent(itemID);return cy},enableMenuItem:function(itemID){enableComponent(itemID);return cy},hideMenuItem:function(itemID){$("#"+itemID).data("show",false);hideComponent($("#"+itemID));return cy},showMenuItem:function(itemID){$("#"+itemID).data("show",true);displayComponent($("#"+itemID));return cy},destroy:function(){destroyCxtMenu();return cy}};return instance}if(opts!=="get"){options=extend(defaults,opts);setScratchProp("options",options);if(getScratchProp("active")){destroyCxtMenu()}setScratchProp("active",true);$cxtMenu=createAndAppendCxtMenuComponent();var menuItems=options.menuItems;createAndAppendMenuItemComponents(menuItems);bindCyEvents();preventDefaultContextTap()}return getInstance(this)})};if(typeof module!=="undefined"&&module.exports){module.exports=register}if(typeof define!=="undefined"&&define.amd){define("cytoscape-context-menus",function(){return register})}if(typeof cytoscape!=="undefined"&&$){register(cytoscape,$)}})();