(function(){"use strict";var defaults={container:false,viewLiveFramerate:0,dblClickDelay:200,removeCustomContainer:true,rerenderDelay:500};var debounce=function(){var FUNC_ERROR_TEXT="Expected a function";var nativeMax=Math.max,nativeNow=Date.now;var now=nativeNow||function(){return(new Date).getTime()};function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=wait<0?0:+wait||0;if(options===true){var leading=true;trailing=false}else if(isObject(options)){leading=!!options.leading;maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait);trailing="trailing"in options?!!options.trailing:trailing}function cancel(){if(timeoutId){clearTimeout(timeoutId)}if(maxTimeoutId){clearTimeout(maxTimeoutId)}lastCalled=0;maxTimeoutId=timeoutId=trailingCall=undefined}function complete(isCalled,id){if(id){clearTimeout(id)}maxTimeoutId=timeoutId=trailingCall=undefined;if(isCalled){lastCalled=now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=undefined}}}function delayed(){var remaining=wait-(now()-stamp);if(remaining<=0||remaining>wait){complete(trailingCall,maxTimeoutId)}else{timeoutId=setTimeout(delayed,remaining)}}function maxDelayed(){complete(trailing,timeoutId)}function debounced(){args=arguments;stamp=now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);if(maxWait===false){var leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled=remaining<=0||remaining>maxWait;if(isCalled){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=undefined}return result}debounced.cancel=cancel;return debounced}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}return debounce}();var throttle=function(func,wait,options){var leading=true,trailing=true;if(options===false){leading=false}else if(typeof options===typeof{}){leading="leading"in options?options.leading:leading;trailing="trailing"in options?options.trailing:trailing}options=options||{};options.leading=leading;options.maxWait=wait;options.trailing=trailing;return debounce(func,wait,options)};var Navigator=function(element,options){this._init(element,options)};var extend=function(){for(var i=1;i<arguments.length;i++){for(var key in arguments[i]){if(arguments[i].hasOwnProperty(key)){arguments[0][key]=arguments[i][key]}}}return arguments[0]};var wid=function(elem){return elem.getBoundingClientRect().width};var hei=function(elem){return elem.getBoundingClientRect().height};Navigator.prototype={constructor:Navigator,bb:function(){var bb=this.cy.elements().boundingBox();if(bb.w===0||bb.h===0){return{x1:0,x2:Infinity,y1:0,y2:Infinity,w:Infinity,h:Infinity}}return bb},_addCyListener:function(events,handler){this._cyListeners.push({events:events,handler:handler});this.cy.on(events,handler)},_removeCyListeners:function(){var cy=this.cy;this._cyListeners.forEach(function(l){cy.off(l.events,l.handler)});cy.offRender(this._onRenderHandler)},_init:function(cy,options){this._cyListeners=[];this.$element=cy.container();this.options=extend({},defaults,options);this.cy=cy;this.boundingBox=this.bb();this.width=wid(this.$element);this.height=hei(this.$element);this._initPanel();this._initThumbnail();this._initView();this._initOverlay()},destroy:function(){this._removeEventsHandling();if(this.options.container&&!this.options.removeCustomContainer){this.$panel.innerHTML=""}else{this.$panel.parentElement.removeChild(this.$panel)}},_initPanel:function(){var options=this.options;if(options.container&&typeof options.container==="string"&&options.container.length>0){if(options.container.indexOf("#")!==-1){this.$panel=document.getElementById(options.container.replace("#",""))}else{this.$panel=document.getElementsByClassName(options.container.replace(".",""))[0]}}else{this.$panel=document.createElement("div");this.$panel.className="cytoscape-navigator";document.body.appendChild(this.$panel)}this._setupPanel();this._addCyListener("resize",this.resize.bind(this))},_setupPanel:function(){this.panelWidth=wid(this.$panel);this.panelHeight=hei(this.$panel)},_initThumbnail:function(){this.$thumbnail=document.createElement("img");this.$panel.appendChild(this.$thumbnail);this._setupThumbnailSizes();this._setupThumbnail()},_setupThumbnail:function(){this._updateThumbnailImage()},_setupThumbnailSizes:function(){this.boundingBox=this.bb();this.thumbnailZoom=Math.min(this.panelHeight/this.boundingBox.h,this.panelWidth/this.boundingBox.w);this.thumbnailPan={x:(this.panelWidth-this.thumbnailZoom*(this.boundingBox.x1+this.boundingBox.x2))/2,y:(this.panelHeight-this.thumbnailZoom*(this.boundingBox.y1+this.boundingBox.y2))/2}},_checkThumbnailSizesAndUpdate:function(){var _zoom=this.thumbnailZoom,_pan_x=this.thumbnailPan.x,_pan_y=this.thumbnailPan.y;this._setupThumbnailSizes();if(_zoom!=this.thumbnailZoom||_pan_x!=this.thumbnailPan.x||_pan_y!=this.thumbnailPan.y){this._setupThumbnail();this._setupView()}else{this._updateThumbnailImage()}},_initView:function(){this.$view=document.createElement("div");this.$view.className="cytoscape-navigatorView";this.$panel.appendChild(this.$view);this.viewBorderTop=parseInt(this.$view.style["border-top-width"],10)||0;this.viewBorderRight=parseInt(this.$view.style["border-right-width"],10)||0;this.viewBorderBottom=parseInt(this.$view.style["border-bottom-width"],10)||0;this.viewBorderLeft=parseInt(this.$view.style["border-left-width"],10)||0;this.viewBorderHorizontal=this.viewBorderLeft+this.viewBorderRight;this.viewBorderVertical=this.viewBorderTop+this.viewBorderBottom;this._setupView();this._addCyListener("zoom pan",this._setupView.bind(this))},_setupView:function(){if(this.viewLocked)return;var cyZoom=this.cy.zoom(),cyPan=this.cy.pan();this.viewW=this.width/cyZoom*this.thumbnailZoom;this.viewX=-cyPan.x*this.viewW/this.width+this.thumbnailPan.x-this.viewBorderLeft;this.viewH=this.height/cyZoom*this.thumbnailZoom;this.viewY=-cyPan.y*this.viewH/this.height+this.thumbnailPan.y-this.viewBorderTop;this.$view.style["width"]=this.viewW+"px";this.$view.style["height"]=this.viewH+"px";this.$view.style["position"]="absolute";this.$view.style["left"]=this.viewX+"px";this.$view.style["top"]=this.viewY+"px"},_initOverlay:function(){this.$overlay=document.createElement("div");this.$overlay.className="cytoscape-navigatorOverlay";this.$panel.appendChild(this.$overlay);this.overlayHookPointX=0;this.overlayHookPointY=0;this._initEventsHandling()},resize:function(){this.width=wid(this.$element);this.height=hei(this.$element);this._thumbnailSetup=false;this._setupPanel();this._checkThumbnailSizesAndUpdate();this._setupView()},_initEventsHandling:function(){var that=this,eventsLocal=["mousedown","mousewheel","DOMMouseScroll","touchstart"],eventsGlobal=["mouseup","mouseout","mousemove","touchmove","touchend"];var overlayListener=function(ev){if(ev.type=="touchstart"){Object.defineProperty(ev,"offsetX",{value:that.viewX+that.viewW/2,writable:true});Object.defineProperty(ev,"offsetY",{value:that.viewY+that.viewH/2,writable:true})}if(ev.offsetX===undefined||ev.offsetY===undefined){var rect=ev.target.getBoundingClientRect();var targetOffset={top:rect.top+window.scrollY,left:rect.left+window.scrollX};Object.defineProperty(ev,"offsetX",{value:ev.pageX-targetOffset.left,writable:true});Object.defineProperty(ev,"offsetY",{value:ev.pageY-targetOffset.top,writable:true})}if(ev.type=="mousedown"||ev.type=="touchstart"){that._eventMoveStart(ev)}else if(ev.type=="mousewheel"||ev.type=="DOMMouseScroll"){that._eventZoom(ev)}return false};var globalListener=function(ev){if(!that.overlayInMovement)return;if(ev.type=="touchend"){Object.defineProperty(ev,"offsetX",{value:that.viewX+that.viewW/2,writable:true});Object.defineProperty(ev,"offsetY",{value:that.viewY+that.viewH/2,writable:true})}else if(ev.type=="touchmove"){Object.defineProperty(ev,"pageX",{value:ev.originalEvent.touches[0].pageX,writable:true});Object.defineProperty(ev,"pageY",{value:ev.originalEvent.touches[0].pageY,writable:true})}if(ev.offsetX===undefined||ev.offsetY===undefined){var rect=ev.target.getBoundingClientRect();var targetOffset={top:rect.top+window.scrollY,left:rect.left+window.scrollX};Object.defineProperty(ev,"offsetX",{value:ev.pageX-targetOffset.left,writable:true});Object.defineProperty(ev,"offsetY",{value:ev.pageY-targetOffset.top,writable:true})}if(ev.target!==that.$overlay){var rect=ev.target.getBoundingClientRect();var rect2=that.$overlay.getBoundingClientRect();var targetOffset={top:rect.top+window.scrollY,left:rect.left+window.scrollX};var overlayOffset={top:rect2.top+window.scrollY,left:rect2.left+window.scrollX};if(targetOffset&&overlayOffset){Object.defineProperty(ev,"offsetX",{value:ev.offsetX-overlayOffset.left+targetOffset.left,writable:true});Object.defineProperty(ev,"offsetY",{value:ev.offsetY-overlayOffset.top+targetOffset.top,writable:true})}else{return false}}if(ev.type=="mousemove"||ev.type=="touchmove"){that._eventMove(ev)}else if(ev.type=="mouseup"||ev.type=="touchend"){that._eventMoveEnd(ev)}return false};for(var i=0;i<eventsLocal.length;i++){this.$overlay.addEventListener(eventsLocal[i],overlayListener,false)}for(var i=0;i<eventsGlobal.length;i++){window.addEventListener(eventsGlobal[i],globalListener,false)}this._removeEventsHandling=function(){for(var i=0;i<eventsLocal.length;i++){this.$overlay.removeEventListener(eventsLocal[i],overlayListener)}for(var i=0;i<eventsGlobal.length;i++){window.removeEventListener(eventsGlobal[i],globalListener)}}},_eventMoveStart:function(ev){var now=(new Date).getTime();if(this.overlayLastMoveStartTime&&this.overlayLastMoveStartTime+this.options.dblClickDelay>now){this.overlayLastMoveStartTime=0;this.overlayInMovement=true;this.overlayHookPointX=this.viewW/2;this.overlayHookPointY=this.viewH/2;if(this.options.viewLiveFramerate!==false){this._eventMove({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2})}else{this._eventMoveEnd({offsetX:this.panelWidth/2,offsetY:this.panelHeight/2})}this.overlayInMovement=false}else{this.overlayLastMoveStartTime=now;this.overlayInMovement=true;this.viewLocked=true;if(ev.offsetX>=this.viewX&&ev.offsetX<=this.viewX+this.viewW&&ev.offsetY>=this.viewY&&ev.offsetY<=this.viewY+this.viewH){this.overlayHookPointX=ev.offsetX-this.viewX;this.overlayHookPointY=ev.offsetY-this.viewY}else{this.overlayHookPointX=this.viewW/2;this.overlayHookPointY=this.viewH/2;this._eventMove(ev)}}},_eventMove:function(ev){var that=this;this._checkMousePosition(ev);if(!this.overlayInMovement){return}this.viewX=ev.offsetX-this.overlayHookPointX;this.viewY=ev.offsetY-this.overlayHookPointY;this.$view.style["left"]=this.viewX+"px";this.$view.style["top"]=this.viewY+"px";if(this.options.viewLiveFramerate!==false){if(this.options.viewLiveFramerate==0){this._moveCy()}else if(!this.overlayTimeout){this.overlayTimeout=setTimeout(function(){that._moveCy();that.overlayTimeout=false},1e3/this.options.viewLiveFramerate)}}},_checkMousePosition:function(ev){if(ev.offsetX>this.viewX&&ev.offsetX<this.viewX+this.viewBorderHorizontal+this.viewW&&ev.offsetY>this.viewY&&ev.offsetY<this.viewY+this.viewBorderVertical+this.viewH){this.$panel.classList.add("mouseover-view")}else{this.$panel.classList.remove("mouseover-view")}},_eventMoveEnd:function(ev){this.viewLocked=false;this.$panel.classList.remove("mouseover-view");if(!this.overlayInMovement){return}this._eventMove(ev);if(this.options.viewLiveFramerate===false){this._moveCy()}this.overlayInMovement=false},_eventZoom:function(ev){var ev2=extend({},ev.originalEvent);var delta=ev.wheelDeltaY/1e3||ev.wheelDelta/1e3||ev.detail/-32||ev2.wheelDeltaY/1e3||ev2.wheelDelta/1e3||ev2.detail/-32;var zoomRate=Math.pow(10,delta),mousePosition={left:ev.offsetX,top:ev.offsetY};if(this.cy.zoomingEnabled()){this._zoomCy(zoomRate,mousePosition)}},_updateThumbnailImage:function(){var that=this;if(this._thumbnailUpdating){return}this._thumbnailUpdating=true;var render=function(){that._checkThumbnailSizesAndUpdate();that._setupView();var $img=that.$thumbnail;var img=$img;var w=that.panelWidth;var h=that.panelHeight;var bb=that.boundingBox;var zoom=Math.min(w/bb.w,h/bb.h);var png=that.cy.png({full:true,scale:zoom,maxHeight:h,maxWidth:w});if(png.indexOf("image/png")<0){img.removeAttribute("src")}else{img.setAttribute("src",png)}var translate={x:(w-zoom*bb.w)/2,y:(h-zoom*bb.h)/2};$img.style["position"]="absolute";$img.style["left"]=translate.x+"px";$img.style["top"]=translate.y+"px"};this._onRenderHandler=throttle(render,that.options.rerenderDelay);this.cy.onRender(this._onRenderHandler)},_moveCy:function(){this.cy.pan({x:-(this.viewX+this.viewBorderLeft-this.thumbnailPan.x)*this.width/this.viewW,y:-(this.viewY+this.viewBorderLeft-this.thumbnailPan.y)*this.height/this.viewH})},_zoomCy:function(zoomRate,zoomCenterRaw){var zoomCenter,isZoomCenterInView=false;zoomCenter={x:this.width/2,y:this.height/2};this.cy.zoom({level:this.cy.zoom()*zoomRate,renderedPosition:zoomCenter})}};var register=function(cytoscape){if(!cytoscape){return}cytoscape("core","navigator",function(options){var cy=this;return new Navigator(cy,options)})};if(typeof module!=="undefined"&&module.exports){module.exports=function(cytoscape){register(cytoscape)}}else if(typeof define!=="undefined"&&define.amd){define("cytoscape-navigator",function(){return register})}if(typeof cytoscape!=="undefined"){register(cytoscape)}})();